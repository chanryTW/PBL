var verson="1.3.3",config={apiKey:"AIzaSyDOFKfb0GTeIYj-lvq8NRn3S3RrJQbZM_I",authDomain:"co-writing-test.firebaseapp.com",databaseURL:"https://co-writing-test.firebaseio.com",projectId:"co-writing-test",storageBucket:"co-writing-test.appspot.com",messagingSenderId:"894137377703",appId:"1:894137377703:web:d5584a32c2b21322e98c82"};firebase.initializeApp(config);var perf=firebase.performance();
function pasw(a){var r="VTCJGAYKFP".split("");if(7!=a.length||9!=r.indexOf(a.substr(0,1))+r.indexOf(a.substr(6,1))||9!=r.indexOf(a.substr(3,1))+r.indexOf(a.substr(4,1)))return"ER";a=""+r.indexOf(a.substr(1,1))+r.indexOf(a.substr(2,1))+r.indexOf(a.substr(5,1));return parseInt(a)}
function paswLock(a){a=a.toString();var r="VTCJGAYKFP".split(""),p=Math.floor(9*Math.random())+0,n=9-p,l=Math.floor(9*Math.random())+0,q=9-l,e;if(10>a){var k=e=0;a=a.substr(0,1)}else 100>a?(e=0,k=a.substr(0,1),a=a.substr(1,1)):(e=a.substr(0,1),k=a.substr(1,1),a=a.substr(2,1));return""+r[p]+r[e]+r[k]+r[l]+r[q]+r[a]+r[n]}
angular.module("app.controllers",["ngImgCrop","angular-bind-html-compile"]).controller("loginCtrl",["$scope","$stateParams","$ionicPopup","$state","$ionicLoading",function(a,r,p,n,l){a.loginSmtBtn=function(){l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u767b\u5165\u4e2d...</p>'});firebase.auth().signInWithEmailAndPassword(accountL.value+"@nkust.edu.tw",pwdL.value).then(function(){console.log("\u767b\u5165\u6210\u529f");var a=accountL.value.toUpperCase();accountL.value=
"";pwdL.value="";l.hide();"ROOT"==a?n.go("rootmenu.root_pbl",{StuID:a}):n.go("choose_class",{StuID:a})})["catch"](function(a){var e=a.code;console.log("\u767b\u5165\u5931\u6557\uff1a",a.message);l.hide();switch(e){case "auth/user-not-found":a=p.alert({title:"\u767b\u5165\u5931\u6557",template:"\u67e5\u7121\u6b64\u5e33\u865f\u3002"});a.then(function(a){accountL.value="";pwdL.value=""});break;case "auth/invalid-email":a=p.alert({title:"\u767b\u5165\u5931\u6557",template:"\u683c\u5f0f\u6709\u8aa4\u3002"});
a.then(function(a){accountL.value=""});break;case "auth/wrong-password":a=p.alert({title:"\u767b\u5165\u5931\u6557",template:"\u5bc6\u78bc\u932f\u8aa4\u3002"}),a.then(function(a){pwdL.value=""})}})};a.forgetBtn=function(){a.data={};p.show({title:"\u5fd8\u8a18\u5bc6\u78bc",subTitle:"\u8acb\u8f38\u5165\u5b78\u865f\uff0c\u91cd\u8a2d\u4fe1\u4ef6\u5c07\u5bc4\u9001\u81f3nkust\u4fe1\u7bb1",template:'<input type="text" ng-model="data.forgetInput" placeholder="ex:C107193000">',scope:a,buttons:[{text:"\u53d6\u6d88",
type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u9001\u51fa",type:"button-chanry1",onTap:function(l){console.log("\u9078\u64c7\u9001\u51fa");firebase.auth().sendPasswordResetEmail(a.data.forgetInput+"@nkust.edu.tw").then(function(){console.log("\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u6210\u529f");p.alert({title:"\u6210\u529f",template:"\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u6210\u529f\uff0c\u8acb\u81f3 "+a.data.forgetInput+"@nkust.edu.tw \u6536\u4fe1"})})["catch"](function(a){console.log("\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u5931\u6557");
switch(a.code){case "auth/user-not-found":p.alert({title:"\u5bc4\u4fe1\u5931\u6557",template:"\u67e5\u7121\u6b64\u5e33\u865f\u3002"})}})}}]})}}]).controller("choose_classCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout",function(a,r,p,n,l){if(null!=r.StuID){n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u8ab2\u7a0b\u4e2d...</p>'});var q=[],e=firebase.firestore();e.collection("\u8ab2\u7a0b").where("ClassStu","array-contains",r.StuID).get().then(function(e){e.forEach(function(e){q.push(e.data());
a.items=q;a.$apply()})});n.hide();a.choose_class=function(a,f){e.collection("\u7cfb\u7d71\u8a18\u9304").doc(a).collection("\u767b\u5165\u7d00\u9304").add({StuID:r.StuID,time:new Date}).then(function(a){console.log("\u7cfb\u7d71\u7d00\u9304 - \u767b\u5165\u7d00\u9304\u6210\u529f")})["catch"](function(a){console.error("\u7cfb\u7d71\u7d00\u9304 - \u767b\u5165\u7d00\u9304\u5931\u6557\uff1a",a)});localStorage.setItem("ClassID",a);localStorage.setItem("ClassName",f);p.go("menu.pbl")}}else console.log("\u932f\u8aa4\u65b9\u5f0f"),
p.go("login")}]).controller("chatroomCtrl",["$scope","$stateParams","$state","$ionicLoading","$ionicScrollDelegate",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){if(e){console.log("\u5df2\u767b\u5165\u72c0\u614b");var k=e.email.substring(0,e.email.indexOf("@")).toUpperCase(),f=localStorage.getItem("ClassID"),g=localStorage.getItem("StuName");a.messages=[];q.collection("\u7559\u8a00\u7248").doc(f).collection("messages").orderBy("time","asc").onSnapshot(function(b){b.docChanges().forEach(function(b){"added"===
b.type&&q.collection("\u5e33\u865f").doc(b.doc.data().StuID).get().then(function(d){firebase.storage().ref().child("members/"+d.data().Img).getDownloadURL().then(function(c){a.messages.push({messageName:b.doc.data().StuID+" "+b.doc.data().StuName,messageImg:c,messageContent:b.doc.data().content,time:b.doc.data().time});a.$apply();l.scrollBottom();l.resize()})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});"modified"===b.type&&console.log("\u4fee\u6539: ",
b.doc.data());"removed"===b.type&&console.log("\u522a\u9664: ",b.doc.data())})});a.addMessage=function(){n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u65b0\u589e\u4e2d...</p>'});void 0!=a.inputMessage&&""!=a.inputMessage&&(q.collection("\u7559\u8a00\u7248").doc(f).collection("messages").add({StuID:k,StuName:g,content:a.inputMessage,time:new Date}).then(function(a){console.log("\u65b0\u589e\u7559\u8a00\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589e\u7559\u8a00\u5931\u6557\uff1a",
a)}),a.inputMessage="");n.hide()}}else console.log("\u5c1a\u672a\u767b\u5165"),p.go("login")})}]).controller("chatroom2Ctrl",["$scope","$stateParams","$state","$ionicLoading","$ionicScrollDelegate",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){if(e){console.log("\u5df2\u767b\u5165\u72c0\u614b");var k=e.email.substring(0,e.email.indexOf("@")).toUpperCase(),f=localStorage.getItem("ClassID"),g=localStorage.getItem("StuName");a.messages=[];q.collection("\u533f\u540d\u7559\u8a00\u7248").doc(f).collection("messages").orderBy("time",
"asc").onSnapshot(function(b){b.docChanges().forEach(function(b){"added"===b.type&&q.collection("\u5e33\u865f").doc(b.doc.data().StuID).get().then(function(d){firebase.storage().ref().child("members/"+d.data().Img).getDownloadURL().then(function(c){var m="\u533f\u540d",d="https://firebasestorage.googleapis.com/v0/b/co-writing-test.appspot.com/o/members%2Fdefault?alt=media&token=e511b185-cd79-47e2-b501-e026fd8da387";"ROOT"==b.doc.data().StuID&&(m=b.doc.data().StuID+" "+b.doc.data().StuName,d=c);a.messages.push({messageName:m,
messageImg:d,messageContent:b.doc.data().content,time:b.doc.data().time});a.$apply();l.scrollBottom();l.resize()})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});"modified"===b.type&&console.log("\u4fee\u6539: ",b.doc.data());"removed"===b.type&&console.log("\u522a\u9664: ",b.doc.data())})});a.addMessage=function(){n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u65b0\u589e\u4e2d...</p>'});void 0!=a.inputMessage&&
""!=a.inputMessage&&(q.collection("\u533f\u540d\u7559\u8a00\u7248").doc(f).collection("messages").add({StuID:k,StuName:g,content:a.inputMessage,time:new Date}).then(function(a){console.log("\u65b0\u589e\u7559\u8a00\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589e\u7559\u8a00\u5931\u6557\uff1a",a)}),a.inputMessage="");n.hide()}}else console.log("\u5c1a\u672a\u767b\u5165"),p.go("login")})}]).controller("pblCtrl",["$scope","$stateParams","$state","$ionicPopup","$ionicLoading","$sce",
function(a,r,p,n,l,q){var e=firebase.firestore();firebase.auth().onAuthStateChanged(function(k){if(k){console.log("\u5df2\u767b\u5165\u72c0\u614b");var f=k.email.substring(0,k.email.indexOf("@")).toUpperCase(),g=localStorage.getItem("ClassID");e.collection("\u8ab2\u7a0b").doc(g).onSnapshot(function(b){a.items=[{ClassName:b.data().ClassName,ClassContent:q.trustAsHtml(b.data().ClassContent),lock:b.data().lock}];a.$apply();1==b.data().lock&&(console.log("\u8ab2\u7a0b\u9396\u5b9a"),p.go("login"))},function(a){console.error("\u8b80\u53d6\u8ab2\u7a0b\u767c\u751f\u932f\u8aa4\uff1a",
a);p.go("login")});e.collection("\u9ede\u6578").doc(g).onSnapshot(function(b){a.PointTops=[];for(var h={$jscomp$loop$prop$index$6:0};h.$jscomp$loop$prop$index$6<b.data().top.length;h={$jscomp$loop$prop$index$6:h.$jscomp$loop$prop$index$6},h.$jscomp$loop$prop$index$6++)e.collection("\u5e33\u865f").doc(b.data().top[h.$jscomp$loop$prop$index$6].StuID).get().then(function(c){return function(m){firebase.storage().ref().child("members/"+m.data().Img).getDownloadURL().then(function(h){a.PointTops.push({Name:m.data().Name,
Img:h,Point:b.data().top[c.$jscomp$loop$prop$index$6].Point});a.$apply()})}}(h))["catch"](function(a){console.log("\u67e5\u8a62\u5e33\u865f\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",a)})},function(a){console.error("\u8b80\u53d6\u9ede\u6578\u6392\u884c\u699c\u767c\u751f\u932f\u8aa4\uff1a",a)});e.collection("\u8ab2\u7a0b").doc(g).onSnapshot(function(b){a.LockGroupShow=b.data().inviteLock;p.go(p.current,{},{reload:!0});console.log("\u662f\u5426\u958b\u653e\u5206\u7d44\uff1a",a.LockGroupShow)},function(a){console.error("\u641c\u5c0b\u662f\u5426\u958b\u653e\u5206\u7d44\u767c\u751f\u932f\u8aa4\uff1a",
a)});var b="";e.collection("\u5206\u7d44").doc(g).collection("student").doc(f).onSnapshot(function(d){!1===d.data().grouped?(console.log("\u6c92\u6709\u5c0f\u7d44",d.data()),a.leaderGroupShow=!1,a.addGroupShow=!0,a.quitGroupShow=!1,a.members=[],localStorage.setItem("GroupID","none"),p.go(p.current,{},{reload:!0})):!0===d.data().grouped&&(console.log("\u6709\u5c0f\u7d44",d.data()),a.addGroupShow=!1,e.collection("\u5206\u7d44").doc(g).collection("group").where("leader","==",f).get().then(function(h){h.empty?
(console.log("\u4f60\u975e\u7d44\u9577"),a.quitGroupShow=!0,e.collection("\u9ede\u6578").doc(g).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask8").set({schedule:0,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)})):(console.log("\u4f60\u662f\u7d44\u9577"),h.forEach(function(a){b=
a.id}),a.leaderGroupShow=!0,e.collection("\u9ede\u6578").doc(g).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask8").set({schedule:1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)}));a.$apply()})["catch"](function(a){console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",
a)}))},function(a){console.log("\u641c\u5c0b\u662f\u5426\u5df2\u6709\u5c0f\u7d44\u767c\u751f\u932f\u8aa4\uff1a",a)});e.collection("\u5206\u7d44").doc(g).collection("group").where("members","array-contains",f).onSnapshot(function(b){b.forEach(function(b){localStorage.setItem("GroupID",b.id);a.members=[];console.log("\u5c0f\u7d44\u72c0\u614b",b.data().members);for(var c={$jscomp$loop$prop$index$8:0};c.$jscomp$loop$prop$index$8<b.data().members.length;c={$jscomp$loop$prop$index$8:c.$jscomp$loop$prop$index$8},
c.$jscomp$loop$prop$index$8++)e.collection("\u5e33\u865f").doc(b.data().members[c.$jscomp$loop$prop$index$8]).get().then(function(c){return function(m){var h=!1;0==c.$jscomp$loop$prop$index$8&&(h=!0);firebase.storage().ref().child("members/"+m.data().Img).getDownloadURL().then(function(d){a.members.push({memberID:b.data().members[c.$jscomp$loop$prop$index$8],memberName:m.data().Name,memberImg:d,leader:h});p.go(p.current,{},{reload:!0});console.log(a.members)})}}(c))["catch"](function(a){console.log("\u67e5\u8a62\u5e33\u865f\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",
a)})})},function(a){console.log("\u6aa2\u67e5\u5c0f\u7d44\u72c0\u614b\u767c\u751f\u932f\u8aa4\uff1a",a)});a.addGroup=function(d){a.Stus=[];l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u5b78\u751f\u4e2d...</p>'});e.collection("\u5206\u7d44").doc(g).collection("student").where("grouped","==",!1).get().then(function(b){b.empty?(console.log("\u5168\u73ed\u90fd\u5df2\u5206\u7d44"),l.hide()):b.forEach(function(c){if(c.id!=f){var m=b.docs[b.docs.length-1].id;
e.collection("\u5e33\u865f").doc(c.id).get().then(function(b){a.Stus.push({StuID:c.id,Name:b.data().Name,Checked:!1});p.go(p.current,{},{reload:!0});c.id==m&&l.hide()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})}});console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\uff1a",a.Stus);p.go(p.current,{},{reload:!0})})["catch"](function(a){console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});a.checkStus=[];e.collection("\u8ab2\u7a0b").doc(g).get().then(function(b){var c=
0;c=0==a.members.length?1:a.members.length;a.maxMember={now:c+a.checkStus.length,maxMember:b.data().maxMembers};a.check=function(m){-1===a.checkStus.indexOf(m)?a.checkStus.push(m):a.checkStus.splice(a.checkStus.indexOf(m),1);c+a.checkStus.length>b.data().maxMembers&&(console.log("\u8d85\u904e\u4e0a\u9650"),a.checkStus.splice(a.checkStus.indexOf(m),1),m=$.map(a.Stus,function(a,c){return a.StuID}).indexOf(m),a.Stus[m].Checked=!1);a.maxMember={now:c+a.checkStus.length,maxMember:b.data().maxMembers};
console.log(a.checkStus)}})["catch"](function(a){console.log("\u67e5\u8a62\u7d44\u54e1\u4e0a\u9650\u767c\u751f\u932f\u8aa4\uff1a",a)});"invite"==d?n.show({title:"\u9078\u64c7\u7d44\u54e1",subTitle:"\u9080\u8acb\u5f8c\u9700\u7b49\u5f85\u5c0d\u65b9\u540c\u610f\u52a0\u5165\u624d\u6703\u52a0\u5165\u3002",template:'<div ng-model="maxMember">\u7d44\u54e1\u4eba\u6578\u9650\u5236\uff1a{{maxMember.now}}/{{maxMember.maxMember}}</div><div ng-repeat="Stu in Stus"><ion-checkbox ng-model="Stu.Checked" ng-click="check(Stu.StuID)">{{Stu.StuID}} {{Stu.Name}}</ion-checkbox></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u9080\u8acb",type:"button-chanry1",onTap:function(d){console.log("\u9078\u64c7\u9080\u8acb");0==a.checkStus.length?(console.log("\u8acb\u52fe\u9078\u6210\u54e1"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u81f3\u5c11\u4e00\u540d\u6210\u54e1\u3002"})):e.collection("\u5206\u7d44").doc(g).collection("group").doc(b).update({inviting:a.checkStus}).then(function(){console.log("\u66f4\u65b0\u5c0f\u7d44\u9080\u8acb\u540d\u55ae\u6210\u529f");
for(var c=0;c<a.checkStus.length;c++)e.collection("\u5206\u7d44").doc(g).collection("student").doc(a.checkStus[c]).collection("invite").add({leader:f,groupID:b,respond:!1}).then(function(){console.log("\u50b3\u9001\u9080\u8acb\u901a\u77e5\u6210\u529f")})["catch"](function(a){console.error("\u50b3\u9001\u9080\u8acb\u901a\u77e5\u5931\u6557\uff1a",a)})})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u7d44\u9080\u8acb\u540d\u55ae\u5931\u6557\uff1a",a)})}}]}):n.show({title:"\u9078\u64c7\u7d44\u54e1",
subTitle:"\u5275\u7acb\u5f8c\u9700\u7b49\u5f85\u5c0d\u65b9\u540c\u610f\u52a0\u5165\u624d\u6703\u52a0\u5165\u3002",template:'<div ng-model="maxMember">\u7d44\u54e1\u4eba\u6578\u9650\u5236\uff1a{{maxMember.now}}/{{maxMember.maxMember}}</div><div ng-repeat="Stu in Stus"><ion-checkbox ng-model="Stu.Checked" ng-click="check(Stu.StuID)">{{Stu.StuID}} {{Stu.Name}}</ion-checkbox></div>',scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},
{text:"\u5275\u7acb",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u5275\u7acb");0==a.checkStus.length?(console.log("\u8acb\u52fe\u9078\u6210\u54e1"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u81f3\u5c11\u4e00\u540d\u6210\u54e1\u3002"})):e.collection("\u5206\u7d44").doc(g).collection("group").add({leader:f,members:[f],inviting:a.checkStus}).then(function(c){var b=c.id;console.log("\u65b0\u589e\u5c0f\u7d44\u6210\u529f");e.collection("\u5206\u7d44").doc(g).collection("student").doc(f).update({grouped:!0}).then(function(c){console.log("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u6210\u529f");
for(c=0;c<a.checkStus.length;c++)e.collection("\u5206\u7d44").doc(g).collection("student").doc(a.checkStus[c]).collection("invite").add({leader:f,groupID:b,respond:!1}).then(function(a){console.log("\u50b3\u9001\u9080\u8acb\u901a\u77e5\u6210\u529f")})["catch"](function(a){console.error("\u50b3\u9001\u9080\u8acb\u901a\u77e5\u5931\u6557\uff1a",a)})})["catch"](function(a){console.error("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u5931\u6557\uff1a",a)})})["catch"](function(a){console.error("\u65b0\u589e\u5c0f\u7d44\u5931\u6557\uff1a",
a)})}}]})};a.delGroup=function(b){"del"==b?n.confirm({title:"\u89e3\u6563\u5c0f\u7d44",template:"\u78ba\u5b9a\u8981\u89e3\u6563\u5c0f\u7d44\u55ce?",subTitle:"\u6ce8\u610f\uff1a\u89e3\u6563\u5f8c\u6703\u522a\u9664\u6240\u6709\u5c0f\u7d44\u8cc7\u6599\uff0c\u5305\u62ec\u8a0e\u8ad6\u7d00\u9304\u3001\u4e0a\u50b3\u4f5c\u696d\u3001\u5206\u7d44\u8a55\u5206...\u7b49\u3002",buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u89e3\u6563",type:"button-chanry1",
onTap:function(b){console.log("\u9078\u64c7\u89e3\u6563");e.collection("\u5206\u7d44").doc(g).collection("group").where("leader","==",f).get().then(function(c){c.empty?console.log("\u89e3\u6563\u5c0f\u7d44\u932f\u8aa4\uff1a\u975e\u7d44\u9577"):c.forEach(function(c){for(var b={$jscomp$loop$prop$index$10:0};b.$jscomp$loop$prop$index$10<c.data().inviting.length;b={$jscomp$loop$prop$index$10:b.$jscomp$loop$prop$index$10},b.$jscomp$loop$prop$index$10++)e.collection("\u5206\u7d44").doc(g).collection("student").doc(c.data().inviting[b.$jscomp$loop$prop$index$10]).collection("invite").where("groupID",
"==",c.id).get().then(function(a){return function(b){b.empty?console.log("\u6536\u56de\u9080\u8acb\u901a\u77e5\u932f\u8aa4\uff1a\u7121\u9808\u6536\u56de\u4e4b\u901a\u77e5"):b.forEach(function(b){e.collection("\u5206\u7d44").doc(g).collection("student").doc(c.data().inviting[a.$jscomp$loop$prop$index$10]).collection("invite").doc(b.id).update({respond:!0}).then(function(a){console.log("\u6536\u56de\u9080\u8acb\u901a\u77e5\u6210\u529f")})["catch"](function(a){console.error("\u6536\u56de\u9080\u8acb\u901a\u77e5\u5931\u6557\uff1a",
a)})})}}(b))["catch"](function(a){console.log("\u6536\u56de\u9080\u8acb\u901a\u77e5\u932f\u8aa4\uff1a",a)});for(b=0;b<c.data().members.length;b++)e.collection("\u5206\u7d44").doc(g).collection("student").doc(c.data().members[b]).update({grouped:!1}).then(function(a){console.log("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u5931\u6557\uff1a",a)});e.collection("\u5206\u7d44").doc(g).collection("group").doc(c.id)["delete"]().then(function(c){console.log("\u89e3\u6563\u5c0f\u7d44\u6210\u529f");
a.members=[];p.go(p.current,{},{reload:!0})})["catch"](function(a){console.error("\u89e3\u6563\u5c0f\u7d44\u5931\u6557\uff1a",a)})})})["catch"](function(a){console.log("\u89e3\u6563\u5c0f\u7d44\u932f\u8aa4\uff1a",a)})}}]}):"quit"==b&&n.confirm({title:"\u9000\u51fa\u5c0f\u7d44",template:"\u78ba\u5b9a\u8981\u9000\u51fa\u5c0f\u7d44\u55ce?",buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u9000\u51fa",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u89e3\u6563");
e.collection("\u5206\u7d44").doc(g).collection("group").where("members","array-contains",f).get().then(function(a){a.forEach(function(a){var c=a.id;a=a.data().members;a.splice(a.indexOf(f),1);e.collection("\u5206\u7d44").doc(g).collection("group").doc(c).update({members:a}).then(function(a){console.log("\u66f4\u65b0members\u8cc7\u6599\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0members\u8cc7\u6599\u5931\u6557\uff1a",a)})})});e.collection("\u5206\u7d44").doc(g).collection("student").doc(f).update({grouped:!1}).then(function(a){console.log("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u5931\u6557\uff1a",
a)})}}]})}}else console.log("\u5c1a\u672a\u767b\u5165"),p.go("login")})}]).controller("voteCtrl",["$scope","$stateParams","$ionicPopup","$state",function(a,r,p,n){var l=firebase.firestore();firebase.auth().onAuthStateChanged(function(q){if(q){console.log("\u5df2\u767b\u5165\u72c0\u614b");var e=q.email.substring(0,q.email.indexOf("@")).toUpperCase(),k=localStorage.getItem("ClassID"),f=localStorage.getItem("GroupID"),g=localStorage.getItem("StuName");a.votes=[];l.collection("\u6295\u7968").doc(k).collection(f).onSnapshot(function(b){b.empty?
(console.log("\u76ee\u524d\u7121\u6295\u7968"),a.votes=[]):b.docChanges().forEach(function(b){if("added"===b.type){var h=!1,c=!1;-1!=b.doc.data().voteN.indexOf(e)?h=!0:-1!=b.doc.data().voteY.indexOf(e)&&(c=!0);var m=0==b.doc.data().solve?"\u6295\u7968\u4e2d":"\u5df2\u7d50\u6848";l.collection("\u5e33\u865f").doc(b.doc.data().StuID).get().then(function(d){firebase.storage().ref().child("members/"+d.data().Img).getDownloadURL().then(function(d){a.votes.push({voteID:b.doc.id,voteStuID:b.doc.data().StuID,
voteName:b.doc.data().StuID+" "+b.doc.data().StuName,voteImg:d,title:b.doc.data().title,type:m,content:b.doc.data().content,voteN:b.doc.data().voteN,voteY:b.doc.data().voteY,voteChooseN:h,voteChooseY:c,time:b.doc.data().time});a.$apply();console.log("\u65b0\u589e\uff1a",a.votes)})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})}if("modified"===b.type){c=h=!1;-1!=b.doc.data().voteN.indexOf(e)?h=!0:-1!=b.doc.data().voteY.indexOf(e)&&(c=!0);
var d=a.votes.findIndex(function(a){return a.voteID===b.doc.id});a.votes[d].voteN=b.doc.data().voteN;a.votes[d].voteY=b.doc.data().voteY;a.votes[d].voteChooseN=h;a.votes[d].voteChooseY=c;m=0==b.doc.data().solve?"\u6295\u7968\u4e2d":"\u5df2\u7d50\u6848";a.votes[d].type=m;a.$apply();console.log("\u4fee\u6539\uff1a",b.doc.data())}"removed"===b.type&&(d=a.votes.findIndex(function(a){return a.time.seconds===b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=d?(a.votes.splice(d,
1),console.log("\u522a\u9664\u5217\u8868\u6210\u529f")):console.log("\u522a\u9664\u5217\u8868\u4e0d\u6210\u529f"),a.$apply(),console.log("\u522a\u9664\uff1a",b.doc.data()))})},function(a){console.log("\u53d6\u5f97\u5efa\u8b70\u767c\u751f\u932f\u8aa4\uff1a",a)});a.votebtn=function(b,d,h){var c=a.votes.findIndex(function(a){return a.voteID===d});-1!=c?("N"==b?-1!=a.votes[c].voteN.indexOf(e)?(a.votes[c].voteN.splice(a.votes[c].voteN.indexOf(e),1),a.votes[c].voteChooseN=!1):(a.votes[c].voteN.push(e),
a.votes[c].voteChooseN=!0,-1!=a.votes[c].voteY.indexOf(e)&&(a.votes[c].voteY.splice(a.votes[c].voteY.indexOf(e),1),a.votes[c].voteChooseY=!1)):"Y"==b&&(-1!=a.votes[c].voteY.indexOf(e)?(a.votes[c].voteY.splice(a.votes[c].voteY.indexOf(e),1),a.votes[c].voteChooseY=!1):(a.votes[c].voteY.push(e),a.votes[c].voteChooseY=!0,-1!=a.votes[c].voteN.indexOf(e)&&(a.votes[c].voteN.splice(a.votes[c].voteN.indexOf(e),1),a.votes[c].voteChooseN=!1))),l.collection("\u5206\u7d44").doc(k).collection("group").doc(f).get().then(function(b){b=
b.data().members.length;if(a.votes[c].voteN.length>b/2||a.votes[c].voteY.length>b/2||a.votes[c].voteN.length==a.votes[c].voteY.length&&a.votes[c].voteY.length==b/2)console.log("\u95dc\u9589\u6295\u7968"),l.collection("\u6295\u7968").doc(k).collection(f).doc(d).update({solve:!0}).then(function(b){console.log("\u95dc\u9589\u6295\u7968\u6210\u529f");a.$apply();l.collection("\u9ede\u6578").doc(k).collection(h).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask5").get().then(function(a){a.exists?
(console.log("\u589e\u52a0\u7d50\u6848\u6b21\u6578"),l.collection("\u9ede\u6578").doc(k).collection(h).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask5").update({schedule:a.data().schedule+1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)})):(console.log("\u7b2c\u4e00\u6b21\u7d50\u6848"),l.collection("\u9ede\u6578").doc(k).collection(h).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask5").set({schedule:1,
time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.log("\u53d6\u5f97\u76ee\u524d\u6b21\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)});b=a.votes[c].voteN.concat(a.votes[c].voteY).concat();for(var m=0;m<b.length;++m)for(var d=m+1;d<b.length;++d)b[m]===b[d]&&b.splice(d,1);b.forEach(function(a){l.collection("\u9ede\u6578").doc(k).collection(a).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask6").get().then(function(b){b.exists?
(console.log("\u589e\u52a0\u7d50\u6848\u6b21\u6578"),l.collection("\u9ede\u6578").doc(k).collection(a).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask6").update({schedule:b.data().schedule+1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)})):(console.log("\u7b2c\u4e00\u6b21\u7d50\u6848"),l.collection("\u9ede\u6578").doc(k).collection(a).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask6").set({schedule:1,
time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.log("\u53d6\u5f97\u76ee\u524d\u6b21\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)})})})["catch"](function(a){console.error("\u95dc\u9589\u6295\u7968\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u53d6\u5f97\u7d44\u54e1\u4eba\u6578\u767c\u751f\u932f\u8aa4\uff1a",
a)}),l.collection("\u6295\u7968").doc(k).collection(f).doc(d).update({voteN:a.votes[c].voteN,voteY:a.votes[c].voteY}).then(function(a){console.log("\u66f4\u65b0\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u53d6\u5f97\u8a72vote\u5931\u6557")};a.Addvote=function(){a.voteInput=[];p.show({title:"\u767c\u8d77\u6295\u7968",template:'<input type="text" ng-model="voteInput.title" placeholder="\u8f38\u5165\u6295\u7968\u6a19\u984c\uff08\u965015\u5b57\u5167\uff09..." maxlength="15" style="margin-bottom:10px; padding:8px;"><textarea cols="50" rows="5" ng-model="voteInput.content" placeholder="\u8f38\u5165\u6295\u7968\u8aaa\u660e\uff08\u965050\u5b57\u5167\uff09..." maxlength="50" style="margin-bottom:10px; padding:8px;"></textarea>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u767c\u8d77",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u767c\u8d77");""==a.voteInput.title||void 0==a.voteInput.title?(console.log("\u8acb\u586b\u5beb\u6295\u7968\u6a19\u984c"),p.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u6295\u7968\u6a19\u984c\u3002"})):""==a.voteInput.content||void 0==a.voteInput.content?(console.log("\u8acb\u586b\u5beb\u6295\u7968\u8aaa\u660e"),
p.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u6295\u7968\u8aaa\u660e\u3002"})):(l.collection("\u6295\u7968").doc(k).collection(f).add({StuID:e,StuName:g,title:a.voteInput.title,content:a.voteInput.content,solve:!1,voteN:[],voteY:[e],time:new Date}).then(function(a){console.log("\u65b0\u589e\u6295\u7968\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589e\u6295\u7968\u5931\u6557\uff1a",a)}),l.collection("\u6295\u7968").doc(k).set({update:new Date}).then(function(a){console.log("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u5931\u6557\uff1a",
a)}))}}]})}}else console.log("\u5c1a\u672a\u767b\u5165"),n.go("login")})}]).controller("missionCtrl",["$scope","$stateParams","$sce","$state","$ionicPopup","$ionicLoading","$ionicScrollDelegate",function(a,r,p,n,l,q,e){var k=firebase.firestore();firebase.auth().onAuthStateChanged(function(f){if(f){console.log("\u5df2\u767b\u5165\u72c0\u614b");var g=f.email.substring(0,f.email.indexOf("@")).toUpperCase(),b=localStorage.getItem("ClassID"),d=localStorage.getItem("GroupID");a.isLeader=!1;a.members=[];
k.collection("\u5206\u7d44").doc(b).collection("group").where("leader","==",g).get().then(function(h){h.empty?(console.log("\u4f60\u975e\u7d44\u9577"),a.isLeader=!1):(console.log("\u4f60\u662f\u7d44\u9577"),a.isLeader=!0,k.collection("\u5206\u7d44").doc(b).collection("group").doc(d).get().then(function(b){a.members=b.data().members})["catch"](function(a){console.log("\u53d6\u5f97\u5c0f\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)}));a.missions=[];k.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(b).collection("\u4efb\u52d9\u5217\u8868").onSnapshot(function(b){b.docChanges().forEach(function(b){if("added"===
b.type){var c=0;1==b.doc.data().lock?c=3:-1!=b.doc.data().finished.indexOf(g)?c=1:b.doc.data().TimeOut.toDate()<new Date?c=2:b.doc.data().LeaderOnly&&!a.isLeader&&(c=3);var m=Number(b.doc.data().TimeOut.toDate().getMonth())+1;9>=m&&(m="0"+m);var h=b.doc.data().TimeOut.toDate().getDate();9>=h&&(h="0"+h);a.missions.push({missionID:b.doc.id,Name:b.doc.data().Name,Content:b.doc.data().Content,TimeOut:b.doc.data().TimeOut.toDate().getUTCFullYear()+"/"+m+"/"+h,LeaderOnly:b.doc.data().LeaderOnly,type:b.doc.data().type,
Point:b.doc.data().Point,finished:b.doc.data().finished,HTML:p.trustAsHtml(b.doc.data().HTML),time:b.doc.data().time,lock:c,hide:!b.doc.data().hide,show:!1,isIRS:b.doc.data().isIRS,showMsg:"\u67e5\u770b\u66f4\u591a"});a.$apply();console.log("\u65b0\u589e: ",a.missions)}else"modified"===b.type?(console.log("\u4fee\u6539: ",b.doc.data()),m=a.missions.findIndex(function(a){return a.time.seconds===b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=m?(c=0,1==b.doc.data().lock?
c=3:-1!=b.doc.data().finished.indexOf(g)?c=1:b.doc.data().TimeOut.toDate()<new Date?c=2:b.doc.data().LeaderOnly&&!a.isLeader&&(c=3),a.missions[m].lock=c,console.log("\u4fee\u6539\u4efb\u52d9\u6210\u529f")):console.log("\u4fee\u6539\u4efb\u52d9\u4e0d\u6210\u529f"),a.$apply()):"removed"===b.type&&(console.log("\u522a\u9664: ",b.doc.data()),m=a.missions.findIndex(function(a){return a.time.seconds===b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=m?(a.missions.splice(m,
1),console.log("\u522a\u9664\u4efb\u52d9\u6210\u529f")):console.log("\u522a\u9664\u4efb\u52d9\u4e0d\u6210\u529f"),a.$apply())})})})["catch"](function(a){console.log("\u5224\u65b7\u7d44\u9577\u767c\u751f\u932f\u8aa4\uff1a",a)});k.collection("\u5206\u7d44").doc(b).collection("group").get().then(function(b){a.groups=[];b.forEach(function(b){if("F107193102"!=b.data().leader)for(var c=[],h={$jscomp$loop$prop$index$12:0};h.$jscomp$loop$prop$index$12<b.data().members.length;h={$jscomp$loop$prop$index$12:h.$jscomp$loop$prop$index$12},
h.$jscomp$loop$prop$index$12++)k.collection("\u5e33\u865f").doc(b.data().members[h.$jscomp$loop$prop$index$12]).get().then(function(m){return function(h){var d=!1;0==m.$jscomp$loop$prop$index$12&&(d=!0);firebase.storage().ref().child("members/"+h.data().Img).getDownloadURL().then(function(g){c.push({memberID:b.data().members[m.$jscomp$loop$prop$index$12],memberName:h.data().Name,memberImg:g,leader:d});a.$apply()})}}(h))["catch"](function(a){console.log("\u67e5\u8a62\u5e33\u865f\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",
a)}),h.$jscomp$loop$prop$index$12==b.data().members.length-1&&(a.groups.push({groupID:b.id,members:c,show:!1}),console.log(a.groups))})})["catch"](function(a){console.log("\u8a55\u5206\u7528 - \u53d6\u5f97\u5168\u90e8\u5c0f\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});a.groupShow=function(b){var c=a.groups.findIndex(function(a){return a.$$hashKey===b.$$hashKey});-1!=c?(a.groups[c].show=a.groups[c].show?!1:!0,console.log("\u4fee\u6539\u986f\u793a\u6210\u529f")):console.log("\u4fee\u6539\u986f\u793a\u4e0d\u6210\u529f")};
a.answerChange=function(b,c,m){a.answer=c;var h=a.groups.findIndex(function(a){return a.groupID===m});-1!=h&&(a.groups[h].finished=!0);h=a.response.findIndex(function(a){return a.missionID===b});-1!=h?a.response[h].answer=c:a.response.push({missionID:b,answer:c});console.log(a.response)};k.collection("\u5206\u7d44").doc(b).collection("group").doc(d).get().then(function(b){a.mission_members=[];for(var c=[],m={$jscomp$loop$prop$index$14:0};m.$jscomp$loop$prop$index$14<b.data().members.length;m={$jscomp$loop$prop$index$14:m.$jscomp$loop$prop$index$14},
m.$jscomp$loop$prop$index$14++)k.collection("\u5e33\u865f").doc(b.data().members[m.$jscomp$loop$prop$index$14]).get().then(function(m){return function(h){var d=!1;0==m.$jscomp$loop$prop$index$14&&(d=!0);var e="";e=b.data().members[m.$jscomp$loop$prop$index$14]==g?"\u6211":h.data().Name;firebase.storage().ref().child("members/"+h.data().Img).getDownloadURL().then(function(h){c.push({memberID:b.data().members[m.$jscomp$loop$prop$index$14],memberName:e,memberImg:h,show:!1,finished:!1,leader:d});a.$apply()})}}(m))["catch"](function(a){console.log("\u67e5\u8a62\u5e33\u865f\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",
a)}),m.$jscomp$loop$prop$index$14==b.data().members.length-1&&(a.mission_members=c)})["catch"](function(a){console.log("\u8a55\u5206\u7528 - \u53d6\u5f97\u5168\u90e8\u5c0f\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});a.memberShow=function(b){var c=a.mission_members.findIndex(function(a){return a.$$hashKey===b.$$hashKey});if(-1!=c){if(a.mission_members[c].show)a.mission_members[c].show=!1;else{a.mission_members[c].show=!0;for(var m=0;m<a.mission_members.length;m++)c!=m&&(a.mission_members[m].show=
!1)}console.log("\u4fee\u6539\u986f\u793a\u6210\u529f")}else console.log("\u4fee\u6539\u986f\u793a\u4e0d\u6210\u529f")};a.answer3Change=function(b,c,m){a.answer3=c;var h=a.mission_members.findIndex(function(a){return a.memberID===m});-1!=h&&(a.mission_members[h].finished=!0);h=a.response.findIndex(function(a){return a.missionID===b});-1!=h?a.response[h].answer=c:a.response.push({missionID:b,answer:c});console.log(a.response)};a.fileChanged=function(h){firebase.storage().ref().child("mission/"+b+"/ARuBqgDSkFJDMHH2UCFg/"+
d).put(h.files[0]).then(function(a){var b=a.bytesTransferred/a.totalBytes*100;q.show({template:"\u5df2\u4e0a\u50b3 "+b+"%"});switch(a.state){case firebase.storage.TaskState.PAUSED:console.log("\u4e0a\u50b3\u66ab\u505c");break;case firebase.storage.TaskState.RUNNING:console.log("\u4e0a\u50b3\u4e2d")}100==b&&(console.log("\u4e0a\u50b3\u6210\u529f"),q.hide())},function(a){console.log("\u4e0a\u50b3\u5931\u6557");q.hide();console.log(a);l.alert({title:"\u4e0a\u50b3\u5931\u6557",template:a})});h=a.response.findIndex(function(a){return"ARuBqgDSkFJDMHH2UCFg"===
a.missionID});-1!=h?a.response[h].answer="\u5df2\u4e0a\u50b3\u6a94\u6848\u81f3\u4f3a\u670d\u5668":a.response.push({missionID:"ARuBqgDSkFJDMHH2UCFg",answer:"\u5df2\u4e0a\u50b3\u6a94\u6848\u81f3\u4f3a\u670d\u5668"});console.log(a.response)};a.answer2Change=function(b,c){var m=a.response.findIndex(function(a){return a.missionID===b});-1!=m?a.response[m].answer=c:a.response.push({missionID:b,answer:c});console.log(a.response)};k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").onSnapshot(function(h){a.SmallTask=
[];a.SmallTask.SmallTask1_finished=!1;a.SmallTask.SmallTask1_schedule=0;a.SmallTask.SmallTask2_finished=!1;a.SmallTask.SmallTask2_schedule=0;a.SmallTask.SmallTask3_finished=!1;a.SmallTask.SmallTask3_schedule=0;a.SmallTask.SmallTask4_finished=!1;a.SmallTask.SmallTask4_schedule=0;a.SmallTask.SmallTask5_finished=!1;a.SmallTask.SmallTask5_schedule=0;a.SmallTask.SmallTask6_finished=!1;a.SmallTask.SmallTask6_schedule=0;a.SmallTask.SmallTask7_finished=!1;a.SmallTask.SmallTask7_schedule=0;a.SmallTask.SmallTask8_finished=
!1;a.SmallTask.SmallTask8_schedule=0;0==h.empty?h.forEach(function(c){"SmallTask1"==c.id?(1<=c.data().schedule?(a.SmallTask.SmallTask1_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask1").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a\u64c1\u6709\u5c0f\u7d44(1/1)",
point:paswLock(15),check:"SmallTask1",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask1_finished=!1,a.SmallTask.SmallTask1_schedule=
c.data().schedule):"SmallTask2_3"==c.id?(5<=c.data().schedule?(a.SmallTask.SmallTask2_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask2").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a\u53c3\u8207\u8166\u529b\u6fc0\u76ea\u8a0e\u8ad6(5/5)",
point:paswLock(10),check:"SmallTask2",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask2_finished=!1,a.SmallTask.SmallTask2_schedule=
c.data().schedule,20<=c.data().schedule?(a.SmallTask.SmallTask3_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask3").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a\u53c3\u8207\u8166\u529b\u6fc0\u76ea\u8a0e\u8ad6(20/20)",
point:paswLock(20),check:"SmallTask3",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask3_finished=!1,a.SmallTask.SmallTask3_schedule=
c.data().schedule):"SmallTask4"==c.id?(10<=c.data().schedule?(a.SmallTask.SmallTask4_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask4").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a\u6309\u8b9a\u8166\u529b\u6fc0\u76ea(10/10)",
point:paswLock(10),check:"SmallTask4",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask4_finished=!1,a.SmallTask.SmallTask4_schedule=
c.data().schedule):"SmallTask5"==c.id?(1<=c.data().schedule?(a.SmallTask.SmallTask5_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask5").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a\u767c\u8d77\u6295\u7968\u4e14\u7d50\u6848(\u6295\u7968\u7cfb\u7d71) (1/1)",
point:paswLock(15),check:"SmallTask5",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask5_finished=!1,a.SmallTask.SmallTask5_schedule=
c.data().schedule):"SmallTask6"==c.id?(5<=c.data().schedule?(a.SmallTask.SmallTask6_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask6").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a\u53c3\u8207\u6295\u7968\u4e14\u7d50\u6848(\u6295\u7968\u7cfb\u7d71) (5/5)",
point:paswLock(5),check:"SmallTask6",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask6_finished=!1,a.SmallTask.SmallTask6_schedule=
c.data().schedule):"SmallTask7"==c.id?(1<=c.data().schedule?(a.SmallTask.SmallTask7_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask7").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a(\u9650\u7d44\u54e1)\u5efa\u8b70\u63d0\u6848\u805a\u7126\u4e14\u88ab\u63a1\u7d0d (1/1)",
point:paswLock(20),check:"SmallTask7",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):a.SmallTask.SmallTask7_finished=!1,a.SmallTask.SmallTask7_schedule=
c.data().schedule):"SmallTask8"==c.id&&(1<=c.data().schedule?(a.SmallTask.SmallTask8_finished=!0,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==","SmallTask8").get().then(function(a){a.empty?(console.log("\u5c1a\u672a\u89e3\u5b8c\u6b64\u5c0f\u4efb\u52d9"),k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a(\u9650\u7d44\u9577)\u64d4\u4efb\u7d44\u9577 (1/1)",
point:paswLock(40),check:"SmallTask8",time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5")})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})):(a.SmallTask.SmallTask8_finished=!1,k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check",
"==","SmallTask8").get().then(function(a){a.empty||a.forEach(function(a){console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5 \u4f46\u5df2\u7d93\u4e0d\u662f\u7d44\u9577\u4e86");k.collection("\u9ede\u6578").doc(b).collection(g).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").doc(a.id)["delete"]().then(function(){console.log("\u6263\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u6263\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",
a)})})})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})),a.SmallTask.SmallTask8_schedule=c.data().schedule);a.$apply()}):console.log("\u5c1a\u7121\u5c0f\u4efb\u52d9")},function(a){console.error("\u53d6\u5f97\u6e2c\u9a57\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",a)});a.GoIRS=function(a,b,d){n.go("menu.irs",{TestID:a,TestName:b,TestContent:d})};a.chooseProposal=[];a.chooseProposalBtn=function(){a.proposals=[];q.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u63d0\u6848\u805a\u7126\u4e2d...</p>'});
k.collection("\u63d0\u6848\u805a\u7126").doc(b).collection(d).get().then(function(b){if(b.empty)console.log("\u7121\u63d0\u6848\u805a\u7126"),q.hide();else{var c=b.docs.length,d=0;b.forEach(function(b){a.proposals.push({ID:b.id,ProposalName:b.data().ProposalName,brainstorming:b.data().brainstorming});d++;d==c&&q.hide()});console.log("\u53d6\u5f97\u63d0\u6848\u805a\u7126\uff1a",a.proposals)}})["catch"](function(a){console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",
a)});a.checkProposals=[];a.proposalBtn=function(b){-1===a.checkProposals.indexOf(b)?a.checkProposals.push(b):a.checkProposals.splice(a.checkProposals.indexOf(b),1);console.log(a.checkProposals)};a.proposalInput=[];l.show({title:"\u9078\u64c7\u63d0\u6848",subTitle:"\u8acb\u9078\u64c7\u63d0\u6848\u805a\u7126\uff0c\u53ef\u591a\u9078\u3002",template:'<div><div class="item item-divider">\u63d0\u6848\u805a\u7126</div><div ng-repeat="proposal in proposals"><ion-checkbox ng-click="proposalBtn(proposal)">{{proposal.ProposalName}}</ion-checkbox></div></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u9078\u64c7",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u9078\u64c7");0==a.checkProposals.length?(console.log("\u8acb\u52fe\u9078\u63d0\u6848\u805a\u7126"),l.alert({title:"\u932f\u8aa4",template:"\u8acb\u52fe\u9078\u81f3\u5c11\u4e00\u9805\u63d0\u6848\u805a\u7126\u3002"})):(a.chooseProposal=a.checkProposals,a.response.proposal=a.checkProposals)}}]})};
a.missionShow=function(b){var c=a.missions.findIndex(function(a){return a.$$hashKey===b.$$hashKey});-1!=c?(a.missions[c].show?(a.missions[c].show=!1,a.missions[c].showMsg="\u67e5\u770b\u66f4\u591a"):(a.missions[c].show=!0,a.missions[c].showMsg="\u6536\u5408\u5167\u5bb9"),console.log("\u4fee\u6539\u986f\u793a\u6210\u529f")):console.log("\u4fee\u6539\u986f\u793a\u4e0d\u6210\u529f")};a.response=[];a.responseBtn=function(d,c){var h=d.missionID,f=a.response.findIndex(function(a){return a.missionID===h});
console.log("\u5224\u65b7\u662f\u5426\u6709\u63d0\u6848\u532f\u5165"+c);void 0!=c&&(a.response[f].answer.POS=c);l.confirm({title:"\u5b58\u6a94\u9001\u51fa",template:"\u78ba\u5b9a\u8981\u9001\u51fa\u55ce?",subTitle:"\u6ce8\u610f\uff1a\u9001\u51fa\u5f8c\u7121\u6cd5\u4fee\u6539\u3002",buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u78ba\u5b9a",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u9001\u51fa");k.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(b).collection("\u4efb\u52d9\u5217\u8868").doc(h).collection("\u586b\u7b54\u7d50\u679c").add({StuID:g,
missionID:h,response:a.response[f].answer,time:new Date}).then(function(c){console.log("\u56de\u50b3\u586b\u7b54\u7d50\u679c\u6210\u529f");k.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(b).collection("\u4efb\u52d9\u5217\u8868").doc(h).get().then(function(c){function m(a){console.log("\u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206"+a);k.collection("\u9ede\u6578").doc(b).collection(a).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==",h).get().then(function(c){c.empty?
(console.log("\u7b2c\u4e00\u6b21\u62ff\u734e\u52f5"),k.collection("\u9ede\u6578").doc(b).collection(a).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a"+d.Name,point:paswLock(d.Point),check:h,time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):(console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5"),
k.collection("\u7cfb\u7d71\u8a18\u9304").doc(b).collection("\u8cc7\u5b89\u56de\u5831").add({StuID:a,Content:"\u5df2\u62ff\u904e"+h+"\u734e\u52f5",time:new Date}).then(function(a){console.log("\u901a\u5831\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u901a\u5831\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",a)})}c=c.data().finished;if(d.LeaderOnly)for(var f=
0;f<a.members.length;++f)c.push(a.members[f]),m(a.members[f]);else c.push(g),m(g);k.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(b).collection("\u4efb\u52d9\u5217\u8868").doc(h).update({finished:c}).then(function(){console.log("\u66f4\u65b0\u5df2\u5b8c\u6210\u540d\u55ae\u6210\u529f");a.missionShow(d);e.scrollTop();a.$apply()})["catch"](function(a){console.error("\u66f4\u65b0\u5df2\u5b8c\u6210\u540d\u55ae\u5931\u6557",a)})})["catch"](function(a){console.log("\u53d6\u5f97\u5df2\u5b8c\u6210\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",
a)})})["catch"](function(a){console.error("\u56de\u50b3\u586b\u7b54\u7d50\u679c\u5931\u6557\uff1a",a)})}}]})}}else console.log("\u5c1a\u672a\u767b\u5165"),n.go("login")})}]).controller("pointCtrl",["$scope","$stateParams","$sce","$state",function(a,r,p,n){var l=firebase.firestore();firebase.auth().onAuthStateChanged(function(q){if(q){console.log("\u5df2\u767b\u5165\u72c0\u614b");var e=q.email.substring(0,q.email.indexOf("@")).toUpperCase(),k=localStorage.getItem("ClassID");a.points=[];l.collection("\u9ede\u6578").doc(k).collection(e).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").onSnapshot(function(f){f.docChanges().forEach(function(g){if("added"===
g.type){var b=pasw(g.doc.data().point);"ER"==b&&l.collection("\u7cfb\u7d71\u8a18\u9304").doc(k).collection("\u8cc7\u5b89\u56de\u5831").add({StuID:e,Content:"\u9ede\u6578\u89e3\u5bc6\u767c\u751f\u932f\u8aa4",time:new Date}).then(function(a){console.log("\u901a\u5831\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u901a\u5831\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)});var d=Number(g.doc.data().time.toDate().getMonth())+1;9>=d&&(d="0"+d);var h=g.doc.data().time.toDate().getDate();
9>=h&&(h="0"+h);d=d+"/"+h;a.points.push({point:b,content:g.doc.data().content,time:d,deltime:g.doc.data().time});console.log("\u65b0\u589e: ",g.doc.data());a.$apply()}else"modified"===g.type?console.log("\u4fee\u6539: ",g.doc.data()):"removed"===g.type&&(console.log("\u522a\u9664: ",g.doc.data()),b=a.points.findIndex(function(a){return a.deltime.seconds===g.doc.data().time.seconds&a.deltime.nanoseconds===g.doc.data().time.nanoseconds}),-1!=b?(a.points.splice(b,1),console.log("\u522a\u9664\u9ede\u6578\u6b77\u7a0b\u8a18\u9304\u6210\u529f")):
console.log("\u522a\u9664\u9ede\u6578\u6b77\u7a0b\u8a18\u9304\u4e0d\u6210\u529f"),a.$apply())})})}else console.log("\u5c1a\u672a\u767b\u5165"),n.go("login")})}]).controller("irsCtrl",["$scope","$stateParams","$sce","$state","$ionicScrollDelegate",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){if(e&&null!=r.TestID){var k=function(c){clearInterval(d);if(c){for(c=1;c<=a.rightAnswer.length;c++)console.log(a.rightAnswer[c-1],a.answer[c]),a.rightAnswer[c-1]==
a.answer[c]&&(h+=1),c>=a.rightAnswer.length&&(a.test.Grade=h==a.rightAnswer.length?100:h*Math.round(100/a.rightAnswer.length));a.response=[{Grade:a.test.Grade,answer:a.answer}];q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(g).collection("\u4efb\u52d9\u5217\u8868").doc(b).get().then(function(c){var d=c.data().Name,h=c.data().Point;c=c.data().finished;c.push(f);q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(g).collection("\u4efb\u52d9\u5217\u8868").doc(b).update({finished:c}).then(function(){console.log("\u66f4\u65b0\u5df2\u5b8c\u6210\u540d\u55ae\u6210\u529f");
q.collection("\u9ede\u6578").doc(g).collection(f).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").where("check","==",b).get().then(function(a){a.empty?(console.log("\u7b2c\u4e00\u6b21\u62ff\u734e\u52f5"),q.collection("\u9ede\u6578").doc(g).collection(f).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:"\u5b8c\u6210\u4efb\u52d9\uff1a"+d,point:paswLock(h),check:b,time:new Date}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",
a)})):(console.log("\u5df2\u62ff\u904e\u6b64\u734e\u52f5"),q.collection("\u7cfb\u7d71\u8a18\u9304").doc(g).collection("\u8cc7\u5b89\u56de\u5831").add({StuID:f,Content:"\u5df2\u62ff\u904e"+b+"\u734e\u52f5",time:new Date}).then(function(a){console.log("\u901a\u5831\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u901a\u5831\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.log("\u9632\u4f5c\u5f0a - \u6aa2\u67e5\u662f\u5426\u5df2\u52a0\u5206\u767c\u751f\u932f\u8aa4\uff1a",
a)});a.$apply()})["catch"](function(a){console.error("\u66f4\u65b0\u5df2\u5b8c\u6210\u540d\u55ae\u5931\u6557",a)})})["catch"](function(a){console.log("\u53d6\u5f97\u5df2\u5b8c\u6210\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)})}else a.response=a.answer?[{answer:a.answer}]:[];q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(g).collection("\u4efb\u52d9\u5217\u8868").doc(b).collection("\u586b\u7b54\u7d50\u679c").doc(f).set({StuID:f,missionID:b,response:a.response,time:new Date}).then(function(a){console.log("\u56de\u50b3\u586b\u7b54\u7d50\u679c\u6210\u529f")})["catch"](function(a){console.error("\u56de\u50b3\u586b\u7b54\u7d50\u679c\u5931\u6557\uff1a",
a)})};console.log("\u5df2\u767b\u5165\u72c0\u614b");var f=e.email.substring(0,e.email.indexOf("@")).toUpperCase(),g=localStorage.getItem("ClassID"),b=r.TestID;q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(g).collection("\u4efb\u52d9\u5217\u8868").doc(b).get().then(function(a){-1!=a.data().finished.indexOf(f)&&(console.log("\u5df2\u5b8c\u6210\u904e\u6e2c\u9a57"),n.go("login"))})["catch"](function(a){console.log("\u6aa2\u67e5\u662f\u5426\u5df2\u5b8c\u6210\u767c\u751f\u932f\u8aa4\uff1a",a)});a.test={};
a.test.Name=r.TestName;a.test.Content=r.TestContent;a.rightAnswer=[];var d,h=0;a.search="fkozq65K\u984c\u76ee\uff1a01";a.pageUpShow=!1;a.pageDownShow=!0;a.FinishBtnShow=!1;a.testStart=!1;a.testContent=!0;a.testOver=!0;q.collection("IRS").doc(g).collection("\u6e2c\u9a57\u5217\u8868").doc(b).onSnapshot(function(b){function c(a){return 9>=a?"0"+String(a):a}var h=b.data().stageTime;a.distance=c(Math.floor(h/36E5))+":"+c(Math.floor(h%36E5/6E4))+":"+c(Math.floor(h%6E4/1E3));if(b.data().testStart){a.questions=
b.data().questions;for(b=0;b<a.questions.length;b++)a.rightAnswer[b]=a.questions[b].answer;b=[];for(var g=0,e=a.questions.length;g<e;g++){var f=Math.floor(Math.random()*a.questions.length);b[g]=a.questions[f];a.questions.splice(f,1)}a.questions=b;for(b=1;b<=a.questions.length;b++){var v;9>=b&&(v="0"+b);a.questions[b-1].search="fkozq65K\u984c\u76ee\uff1a"+v}a.testStart=!0;a.testContent=!1;a.pageUpDownShow=!0;a.$apply();d=setInterval(function(){h-=1E3;a.distance=c(Math.floor(h/36E5))+":"+c(Math.floor(h%
36E5/6E4))+":"+c(Math.floor(h%6E4/1E3));a.$apply();0>=h&&1==a.testOver&&(k(!0),a.testStart=!0,a.testContent=!0,a.testOver=!1,a.pageUpDownShow=!1,l.scrollTop(),a.$apply())},1E3)}else k(!1),a.testStart=!1,a.testContent=!0,a.testOver=!0,a.pageUpDownShow=!1,l.scrollTop(),a.$apply()},function(a){console.error("\u53d6\u5f97\u6e2c\u9a57\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",a)});a.pageUp=function(b){b=b?parseInt(a.search.substr(11))-1:parseInt(a.search.substr(11))+1;9>=b&&(b="0"+b);a.search="fkozq65K\u984c\u76ee\uff1a"+
b;b=a.questions.length;9>=b&&(b="0"+b);"fkozq65K\u984c\u76ee\uff1a01"==a.search?(a.pageUpShow=!1,a.pageDownShow=!0,a.FinishBtnShow=!1):a.search=="fkozq65K\u984c\u76ee\uff1a"+b?(a.pageUpShow=!0,a.pageDownShow=!1,a.FinishBtnShow=!0):(a.pageUpShow=!0,a.pageDownShow=!0,a.FinishBtnShow=!1);k(!1)};a.testFinishBtn=function(){k(!0);a.testStart=!0;a.testContent=!0;a.testOver=!1;a.pageUpDownShow=!1;l.scrollTop()};a.answerChange=function(b){ary=[];for(d in b)ary[ary.length]=d;a.answer=b;a.answerAry=ary}}else console.log("\u5c1a\u672a\u767b\u5165"),
n.go("login")})}]).controller("brainstormingCtrl",["$scope","$stateParams","$state","$ionicScrollDelegate","$ionicLoading","$ionicPopup",function(a,r,p,n,l,q){var e=firebase.firestore();firebase.auth().onAuthStateChanged(function(k){if(k){console.log("\u5df2\u767b\u5165\u72c0\u614b");var f=k.email.substring(0,k.email.indexOf("@")).toUpperCase(),g=localStorage.getItem("StuName"),b=localStorage.getItem("ClassID"),d=localStorage.getItem("GroupID");a.search="fkozq65K\u9801\u7c64\uff1a1";a.tabs=function(h){if("+"==
h)10<=a.tabsCounts.length?q.confirm({title:"\u65b0\u589e\u5206\u9801",template:"\u5206\u9801\u5df2\u5230\u4e0a\u9650(10\u9801)\u3002",buttons:[{text:"\u597d\u7684",type:"button-chanry1",onTap:function(a){}}]}):q.confirm({title:"\u65b0\u589e\u5206\u9801",template:"\u78ba\u5b9a\u8981\u65b0\u589e\u55ce?",subTitle:"\u6ce8\u610f\uff1a\u65b0\u589e\u5f8c\u7121\u6cd5\u522a\u9664\uff0c\u4e0a\u9650\u70ba10\u500b\u5206\u9801\u3002",buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},
{text:"\u78ba\u5b9a",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u65b0\u589e");e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc("\u9801\u7c64").update({count:a.tabsCounts.length+1}).then(function(){console.log("\u65b0\u589e\u5206\u9801\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589e\u5206\u9801\u5931\u6557",a)})}}]});else{a.search="fkozq65K\u9801\u7c64\uff1a"+h;var c=a.tabsCounts.findIndex(function(a){return!0===a.active});a.tabsCounts[c].num=
c+1;a.tabsCounts[c].active=!1;a.tabsCounts[h-1].num=h;a.tabsCounts[h-1].active=!0;n.scrollBottom()}};e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc("\u9801\u7c64").onSnapshot(function(h){if(h.exists){a.tabsCounts=[];for(var c=1;c<=h.data().count;c++)1==c?a.tabsCounts.push({num:c,active:!0}):a.tabsCounts.push({num:c,active:!1});a.$apply()}else e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc("\u9801\u7c64").set({count:3}).then(function(){console.log("\u521d\u59cb\u5316\u5206\u9801\u6210\u529f")})["catch"](function(a){console.error("\u521d\u59cb\u5316\u5206\u9801\u5931\u6557",
a)})});a.items=[];e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).orderBy("time","asc").onSnapshot({includeMetadataChanges:!0},function(b){b.docChanges().forEach(function(b){if("added"===b.type){var c=b.doc.data();c.ID=b.doc.id;-1!=c.like.indexOf(f)?c.likeBtn=!0:c.likeBtn=!1;a.items.push(c);a.$apply();n.scrollBottom();console.log("\u65b0\u589e: ",c)}if("modified"===b.type){c=b.doc.data();c.ID=b.doc.id;-1!=c.like.indexOf(f)?c.likeBtn=!0:c.likeBtn=!1;var d=a.items.findIndex(function(a){return a.time.seconds===
b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds});-1!=d?(a.items.splice(d,1,c),console.log("\u4fee\u6539\u5217\u8868\u6210\u529f")):console.log("\u4fee\u6539\u5217\u8868\u4e0d\u6210\u529f");a.$apply();console.log("\u4fee\u6539: ",b.doc.data())}"removed"===b.type&&(console.log("\u522a\u9664: ",b.doc.data()),d=a.items.findIndex(function(a){return a.time.seconds===b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=d?(a.items.splice(d,1),console.log("\u522a\u9664\u5217\u8868\u6210\u529f")):
console.log("\u522a\u9664\u5217\u8868\u4e0d\u6210\u529f"),a.$apply())})});a.add=function(){l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u65b0\u589e\u4e2d...</p>'});void 0!=a.input&&""!=a.input&&(e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).add({StuID:f,StuName:g,msg:a.input,like:[],invited:!1,search:a.search,time:new Date}).then(function(a){console.log("\u65b0\u589e\u8166\u529b\u6fc0\u76ea\u6210\u529f");e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).where("StuID",
"==",f).get().then(function(a){e.collection("\u9ede\u6578").doc(b).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask2_3").set({schedule:a.size,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9 \u81ea\u5df1\u8166\u529b\u6fc0\u76ea\u6b21\u6578\u767c\u751f\u932f\u8aa4\uff1a",
a)});e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).set({update:new Date}).then(function(a){console.log("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u5931\u6557\uff1a",a)})})["catch"](function(a){console.error("\u65b0\u589e\u8166\u529b\u6fc0\u76ea\u5931\u6557\uff1a",a)}),a.input="");l.hide()};a.Delete=function(a){l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u522a\u9664\u4e2d...</p>'});
e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).where("time","==",a.time).get().then(function(a){a.forEach(function(a){e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc(a.id)["delete"]().then(function(){console.log("\u522a\u9664\u8166\u529b\u6fc0\u76ea\u6210\u529f")})["catch"](function(a){console.error("\u522a\u9664\u8166\u529b\u6fc0\u76ea\u5931\u6557\uff1a",a)})})});l.hide()};a.like=function(a){1==a.likeBtn?(a.like.splice(a.like.indexOf(f),1),e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc(a.ID).update({like:a.like}).then(function(a){console.log("\u66f4\u65b0\u6309\u8b9a\u72c0\u614b\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u6309\u8b9a\u72c0\u614b\u5931\u6557\uff1a",
a)}),e.collection("\u9ede\u6578").doc(b).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask4").get().then(function(a){console.log("\u6e1b\u5c11\u6309\u8b9a\u6b21\u6578");e.collection("\u9ede\u6578").doc(b).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask4").update({schedule:a.data().schedule-1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",
a)})})["catch"](function(a){console.log("\u53d6\u5f97\u76ee\u524d\u6b21\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)})):(a.like.push(f),e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc(a.ID).update({like:a.like}).then(function(a){console.log("\u66f4\u65b0\u6309\u8b9a\u72c0\u614b\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u6309\u8b9a\u72c0\u614b\u5931\u6557\uff1a",a)}),e.collection("\u9ede\u6578").doc(b).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask4").get().then(function(a){a.exists?
(console.log("\u589e\u52a0\u6309\u8b9a\u6b21\u6578"),e.collection("\u9ede\u6578").doc(b).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask4").update({schedule:a.data().schedule+1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)})):(console.log("\u7b2c\u4e00\u6b21\u6309\u8b9a"),e.collection("\u9ede\u6578").doc(b).collection(f).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask4").set({schedule:1,
time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.log("\u53d6\u5f97\u76ee\u524d\u6b21\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)}))};e.collection("\u5206\u7d44").doc(b).collection("group").where("leader","==",f).get().then(function(b){b.empty?(console.log("\u4f60\u975e\u7d44\u9577"),a.DelAllBtnShow=!1):(console.log("\u4f60\u662f\u7d44\u9577"),
a.DelAllBtnShow=!0)})["catch"](function(a){console.log("\u5224\u65b7\u7d44\u9577\u767c\u751f\u932f\u8aa4\uff1a",a)});a.DelAllBtn=function(){q.confirm({title:"\u6e05\u7a7a\u8166\u529b\u6fc0\u76ea\u8cc7\u6599",template:"\u78ba\u5b9a\u8981\u6e05\u7a7a\u55ce?",subTitle:"\u6ce8\u610f\uff1a\u6e05\u7a7a\u6703\u522a\u9664\u5168\u9ad4\u7d44\u54e1\u8166\u529b\u6fc0\u76ea\u8cc7\u6599\u3002",buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u78ba\u5b9a",
type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u6e05\u7a7a");e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).get().then(function(a){a.forEach(function(a){e.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(d).doc(a.id)["delete"]().then(function(){console.log("\u522a\u9664\u8166\u529b\u6fc0\u76ea\u6210\u529f")})["catch"](function(a){console.error("\u522a\u9664\u8166\u529b\u6fc0\u76ea\u5931\u6557\uff1a",a)})})})["catch"](function(a){console.log("\u67e5\u8a62\u5168\u90e8\u8a0a\u606f\u767c\u751f\u932f\u8aa4\uff1a",
a)})}}]})}}else console.log("\u5c1a\u672a\u767b\u5165"),p.go("login")})}]).controller("proposalCtrl",["$scope","$stateParams","$state","$ionicPopup","$ionicLoading","$ionicScrollDelegate",function(a,r,p,n,l,q){var e=firebase.firestore();firebase.auth().onAuthStateChanged(function(k){if(k){console.log("\u5df2\u767b\u5165\u72c0\u614b");var f=k.email.substring(0,k.email.indexOf("@")).toUpperCase();localStorage.getItem("StuName");var g=localStorage.getItem("ClassID"),b=localStorage.getItem("GroupID");
e.collection("\u5206\u7d44").doc(g).collection("group").where("leader","==",f).get().then(function(b){b.empty?(console.log("\u4f60\u975e\u7d44\u9577"),a.leaderGroupShow=!1):(console.log("\u4f60\u662f\u7d44\u9577"),a.leaderGroupShow=!0)})["catch"](function(a){console.log("\u5224\u65b7\u7d44\u9577\u767c\u751f\u932f\u8aa4\uff1a",a)});a.items=[];e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).orderBy("time","asc").onSnapshot({includeMetadataChanges:!0},function(c){c.docChanges().forEach(function(c){if("added"===
c.type){var d=c.doc.data(),h=[];d.brainstorming.forEach(function(c){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(c).get().then(function(b){h.push(b.data());a.$apply()})["catch"](function(a){console.log("\u8166\u529b\u6fc0\u76ea\u5167\u5bb9\u767c\u751f\u932f\u8aa4\uff1a",a)})});var t=!1;-1!=c.doc.data().bellBadge.indexOf(f)&&(t=!0);a.items.push({ProposalName:d.ProposalName,brainstorming:h,bellBadge:t,time:d.time});q.scrollBottom();console.log("\u65b0\u589e: ",a.items)}else"modified"===
c.type?(console.log("\u4fee\u6539: ",c.doc.data()),d=c.doc.data(),h=[],d.brainstorming.forEach(function(c){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(c).get().then(function(b){h.push(b.data());a.$apply()})["catch"](function(a){console.log("\u8166\u529b\u6fc0\u76ea\u5167\u5bb9\u767c\u751f\u932f\u8aa4\uff1a",a)})}),d.brainstorming=h,-1!=d.bellBadge.indexOf(f)&&(d.bellBadge=!0),t=a.items.findIndex(function(a){return a.time.seconds===c.doc.data().time.seconds&a.time.nanoseconds===
c.doc.data().time.nanoseconds}),-1!=t?(a.items.splice(t,1,d),console.log("\u4fee\u6539\u5217\u8868\u6210\u529f")):console.log("\u4fee\u6539\u5217\u8868\u4e0d\u6210\u529f"),a.$apply(),console.log("\u4fee\u6539: ",a.items)):"removed"===c.type&&(console.log("\u522a\u9664: ",c.doc.data()),t=a.items.findIndex(function(a){return a.time.seconds===c.doc.data().time.seconds&a.time.nanoseconds===c.doc.data().time.nanoseconds}),-1!=t?(a.items.splice(t,1),console.log("\u522a\u9664\u5217\u8868\u6210\u529f")):
console.log("\u522a\u9664\u5217\u8868\u4e0d\u6210\u529f"),a.$apply())})});a.bells=[];var d,h="";a.bellProposal=function(c){a.bells=[];l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u5efa\u8b70\u4e2d...</p>'});e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).where("time","==",c).get().then(function(c){c.forEach(function(c){h=c.id;d=e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).collection("\u5efa\u8b70").where("solve",
"==",!1).onSnapshot(function(c){if(c.empty)console.log("\u76ee\u524d\u7121\u5efa\u8b70"),a.bells=[],l.hide();else{var d=c.docs.length,h=0;c.docChanges().forEach(function(c){if("added"===c.type){var t=[];c.doc.data().brainstorming.forEach(function(c){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(c).get().then(function(b){t.push({brainstormingID:b.id,msg:b.data().msg});a.$apply()})["catch"](function(a){console.log("\u53d6\u5f97\u8166\u529b\u6fc0\u76ea\u5167\u5bb9\u767c\u751f\u932f\u8aa4\uff1a",
a)})});var k=!1,m=!1;-1!=c.doc.data().voteN.indexOf(f)?k=!0:-1!=c.doc.data().voteY.indexOf(f)&&(m=!0);a.bells.push({bellID:c.doc.id,StuID:c.doc.data().StuID,bellTime:c.doc.data().time,voteN:c.doc.data().voteN,voteY:c.doc.data().voteY,voteChooseN:k,voteChooseY:m,time:c.doc.data().time,bellBrainstorming:t});h++;h==d&&l.hide();a.$apply();console.log("\u65b0\u589e\uff1a",c.doc.data())}if("modified"===c.type){m=k=!1;-1!=c.doc.data().voteN.indexOf(f)?k=!0:-1!=c.doc.data().voteY.indexOf(f)&&(m=!0);var u=
a.bells.findIndex(function(a){return a.bellID===c.doc.id});a.bells[u].voteN=c.doc.data().voteN;a.bells[u].voteY=c.doc.data().voteY;a.bells[u].voteChooseN=k;a.bells[u].voteChooseY=m;a.$apply();console.log("\u4fee\u6539\uff1a",c.doc.data())}"removed"===c.type&&(u=a.bells.findIndex(function(a){return a.time.seconds===c.doc.data().time.seconds&a.time.nanoseconds===c.doc.data().time.nanoseconds}),-1!=u?(a.bells.splice(u,1),console.log("\u522a\u9664\u5217\u8868\u6210\u529f")):console.log("\u522a\u9664\u5217\u8868\u4e0d\u6210\u529f"),
a.$apply(),console.log("\u522a\u9664\uff1a",c.doc.data()))})}},function(a){console.log("\u53d6\u5f97\u5efa\u8b70\u767c\u751f\u932f\u8aa4\uff1a",a)});-1!=c.data().bellBadge.indexOf(f)&&(c=c.data(),c.bellBadge.splice(c.bellBadge.indexOf(f),1),e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).update({bellBadge:c.bellBadge}).then(function(a){console.log("\u5c07\u7d05\u9ede\u95dc\u9589 - \u66f4\u65b0\u63d0\u6848\u6210\u529f")})["catch"](function(a){console.error("\u5c07\u7d05\u9ede\u95dc\u9589 - \u66f4\u65b0\u63d0\u6848\u5931\u6557\uff1a",
a)}))})})["catch"](function(a){console.log("\u53d6\u5f97\u63d0\u6848ID\u767c\u751f\u932f\u8aa4\uff1a",a)});n.show({title:"\u7d44\u54e1\u5efa\u8b70\u4e4b\u8166\u529b\u6fc0\u76ea",subTitle:"\u8acb\u9032\u884c\u6295\u7968\uff0c\u8d0a\u6210\u904e\u534a\u81ea\u52d5\u6210\u7acb\uff0c\u53cd\u4e4b\u5426\u6c7a\u5efa\u8b70\u3002",template:'<div ng-repeat="bell in bells | orderBy:\'time\'"><div class="item item-divider">\u3010\u533f\u540d\u3011\u5efa\u8b70\u52a0\u5165\u4ee5\u4e0b\u8166\u529b\u6fc0\u76ea</div><div ng-repeat="bellBrainstorming in bell.bellBrainstorming"><div class="item">{{$index+1}}.{{bellBrainstorming.msg}}</div></div><div class="item vote"><div class="voteN" style="width:{{bell.voteN.length / (bell.voteN.length + bell.voteY.length) * 100}}%"></div><span class="votespan" style="left:16px;">\u53cd\u5c0d\uff1a{{bell.voteN.length}}</span><span class="votespan" style="right:16px;">\u8d0a\u6210\uff1a{{bell.voteY.length}}</span></div><div class="item row VoteHeight"><div class="col col-50"><i ng-click="votebtn(\'N\',bell.bellID,bell.StuID)" ng-class="{true:\'voteChooseN\',false:\'voteNbtn\'}[bell.voteChooseN]" ></i></div><div class="col col-50"><i ng-click="votebtn(\'Y\',bell.bellID,bell.StuID)" ng-class="{true:\'voteChooseY\',false:\'voteYbtn\'}[bell.voteChooseY]" ></i></div></div><div class="spacer" style="height: 20px;"></div></div>',
scope:a,buttons:[{text:"\u95dc\u9589",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u95dc\u9589");d()}}]})};a.votebtn=function(c,d,k){var m=a.bells.findIndex(function(a){return a.bellID===d});-1!=m?("N"==c?-1!=a.bells[m].voteN.indexOf(f)?(a.bells[m].voteN.splice(a.bells[m].voteN.indexOf(f),1),a.bells[m].voteChooseN=!1):(a.bells[m].voteN.push(f),a.bells[m].voteChooseN=!0,-1!=a.bells[m].voteY.indexOf(f)&&(a.bells[m].voteY.splice(a.bells[m].voteY.indexOf(f),1),a.bells[m].voteChooseY=
!1)):"Y"==c&&(-1!=a.bells[m].voteY.indexOf(f)?(a.bells[m].voteY.splice(a.bells[m].voteY.indexOf(f),1),a.bells[m].voteChooseY=!1):(a.bells[m].voteY.push(f),a.bells[m].voteChooseY=!0,-1!=a.bells[m].voteN.indexOf(f)&&(a.bells[m].voteN.splice(a.bells[m].voteN.indexOf(f),1),a.bells[m].voteChooseN=!1))),e.collection("\u5206\u7d44").doc(g).collection("group").doc(b).get().then(function(c){c=c.data().members.length;a.bells[m].voteN.length>c/2||a.bells[m].voteN.length==a.bells[m].voteY.length&&a.bells[m].voteY.length==
c/2?(console.log("\u5426\u6c7a\u5efa\u8b70or\u5e73\u624b"),e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).collection("\u5efa\u8b70").doc(d).update({solve:!0}).then(function(b){console.log("\u95dc\u9589\u5efa\u8b70\u6210\u529f");a.$apply()})["catch"](function(a){console.error("\u95dc\u9589\u5efa\u8b70\u5931\u6557\uff1a",a)})):a.bells[m].voteY.length>c/2&&(console.log("\u5efa\u8b70\u6210\u7acb"),e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).get().then(function(c){var f=
[];a.bells[m].bellBrainstorming.forEach(function(a){f.push(a.brainstormingID)});c=c.data().brainstorming.concat(f).concat();for(var k=0;k<c.length;++k)for(var t=k+1;t<c.length;++t)c[k]===c[t]&&c.splice(t,1);e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).update({brainstorming:c}).then(function(c){console.log("\u66f4\u65b0\u63d0\u6848\u6210\u529f");f.forEach(function(c){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(c).update({invited:!0}).then(function(a){console.log("\u6a19\u8a18\u63d0\u6848\u6210\u529f")})["catch"](function(a){console.error("\u6a19\u8a18\u63d0\u6848\u5931\u6557\uff1a",
a)});e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).collection("\u5efa\u8b70").doc(d).update({solve:!0}).then(function(b){console.log("\u95dc\u9589\u5efa\u8b70\u6210\u529f");a.$apply()})["catch"](function(a){console.error("\u95dc\u9589\u5efa\u8b70\u5931\u6557\uff1a",a)})})})["catch"](function(a){console.error("\u66f4\u65b0\u63d0\u6848\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u53d6\u5f97\u63d0\u6848\u805a\u7126\u5167\u8166\u529b\u6fc0\u76ea\u9663\u5217\u767c\u751f\u932f\u8aa4\uff1a",
a)}),e.collection("\u9ede\u6578").doc(g).collection(k).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask7").get().then(function(a){a.exists?(console.log("\u589e\u52a0\u5efa\u8b70\u6210\u7acb\u6b21\u6578"),e.collection("\u9ede\u6578").doc(g).collection(k).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask7").update({schedule:a.data().schedule+1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",
a)})):(console.log("\u7b2c\u4e00\u6b21\u5efa\u8b70\u6210\u7acb"),e.collection("\u9ede\u6578").doc(g).collection(k).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask7").set({schedule:1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.log("\u53d6\u5f97\u76ee\u524d\u6b21\u6578\u767c\u751f\u932f\u8aa4\uff1a",
a)}))})["catch"](function(a){console.log("\u53d6\u5f97\u7d44\u54e1\u4eba\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)}),e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(h).collection("\u5efa\u8b70").doc(d).update({voteN:a.bells[m].voteN,voteY:a.bells[m].voteY}).then(function(a){console.log("\u66f4\u65b0\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)})):console.log("\u53d6\u5f97\u8a72bell\u5931\u6557")};a.AddProposal=
function(c,d){a.proposals=[];l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u8166\u529b\u6fc0\u76ea\u4e2d...</p>'});e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).where("invited","==",!1).get().then(function(b){if(b.empty)console.log("\u5168\u90fd\u5df2\u65b0\u589eor\u7121\u8166\u529b\u6fc0\u76ea"),l.hide();else{var c=b.docs.length,d=0;b.forEach(function(b){a.proposals.push({ID:b.id,msg:b.data().msg,like:b.data().like.length,search:Number(b.data().search.substr(11))});
d++;d==c&&l.hide()});console.log("\u53d6\u5f97\u8166\u529b\u6fc0\u76ea\u540d\u55ae\uff1a",a.proposals)}})["catch"](function(a){console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});var h=[];a.proposalsForFilter=function(){h=[];return a.proposals};a.searchFilter=function(a){var b=-1==h.indexOf(a.search);b&&h.push(a.search);return b};a.checkProposals=[];a.proposalBtn=function(b){-1===a.checkProposals.indexOf(b)?a.checkProposals.push(b):a.checkProposals.splice(a.checkProposals.indexOf(b),
1);console.log(a.checkProposals)};a.proposalInput=[];"Add"==c?n.show({title:"\u65b0\u589e\u63d0\u6848",subTitle:"\u8acb\u9078\u64c7\u52a0\u5165\u63d0\u6848\u4e4b\u8166\u529b\u6fc0\u76ea\u3002",template:'<input type="text" ng-model="proposalInput.content" placeholder="\u8f38\u5165\u63d0\u6848\u6a19\u984c\uff08\u965015\u5b57\u5167\uff09..." maxlength="15" style="margin-bottom:10px; padding:8px;"><div ng-repeat="proposalsPerSearch in proposalsForFilter() | filter:searchFilter | orderBy:\'search\'"><div class="item item-divider">\u8166\u529b\u6fc0\u76ea{{proposalsPerSearch.search}}</div><div ng-repeat="proposal in proposals | filter:{search:proposalsPerSearch.search} | orderBy:\'-like\' "><ion-checkbox ng-click="proposalBtn(proposal.ID)">{{proposal.like}}\u8b9a\uff1a{{proposal.msg}}</ion-checkbox></div></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u65b0\u589e",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u65b0\u589e");""==a.proposalInput.content||void 0==a.proposalInput.content?(console.log("\u8acb\u586b\u5beb\u63d0\u6848\u6a19\u984c"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u63d0\u6848\u6a19\u984c\u3002"})):0==a.checkProposals.length?(console.log("\u8acb\u52fe\u9078\u8166\u529b\u6fc0\u76ea"),
n.alert({title:"\u932f\u8aa4",template:"\u8acb\u52fe\u9078\u81f3\u5c11\u4e00\u9805\u8166\u529b\u6fc0\u76ea\u3002"})):e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).add({ProposalName:a.proposalInput.content,brainstorming:a.checkProposals,bellBadge:[],time:new Date}).then(function(c){console.log("\u65b0\u589e\u63d0\u6848\u6210\u529f");a.checkProposals.forEach(function(a){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(a).update({invited:!0}).then(function(a){console.log("\u6a19\u8a18\u63d0\u6848\u6210\u529f")})["catch"](function(a){console.error("\u6a19\u8a18\u63d0\u6848\u5931\u6557\uff1a",
a)})});e.collection("\u63d0\u6848\u805a\u7126").doc(g).set({update:new Date}).then(function(a){console.log("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u5931\u6557\uff1a",a)})})["catch"](function(a){console.error("\u65b0\u589e\u63d0\u6848\u5931\u6557\uff1a",a)})}}]}):"Invite"==c&&(a.leaderGroupShow?n.show({title:"\u52a0\u5165\u8166\u529b\u6fc0\u76ea",subTitle:"\u8acb\u9078\u64c7\u52a0\u5165\u6b64\u63d0\u6848\u4e4b\u8166\u529b\u6fc0\u76ea\u3002",
template:'<div ng-repeat="proposalsPerSearch in proposalsForFilter() | filter:searchFilter | orderBy:\'search\'"><div class="item item-divider">\u8166\u529b\u6fc0\u76ea{{proposalsPerSearch.search}}</div><div ng-repeat="proposal in proposals | filter:{search:proposalsPerSearch.search} | orderBy:\'-like\' "><ion-checkbox ng-click="proposalBtn(proposal.ID)">{{proposal.like}}\u8b9a\uff1a{{proposal.msg}}</ion-checkbox></div></div>',scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},
{text:"\u52a0\u5165",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u52a0\u5165");0==a.checkProposals.length?(console.log("\u8acb\u52fe\u9078\u8166\u529b\u6fc0\u76ea"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u52fe\u9078\u81f3\u5c11\u4e00\u9805\u8166\u529b\u6fc0\u76ea\u3002"})):e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).where("time","==",d).get().then(function(c){c.forEach(function(c){var d=c.id;e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(d).get().then(function(c){e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(d).update({brainstorming:c.data().brainstorming.concat(a.checkProposals)}).then(function(c){console.log("\u66f4\u65b0\u63d0\u6848\u6210\u529f");
a.checkProposals.forEach(function(a){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(a).update({invited:!0}).then(function(a){console.log("\u6a19\u8a18\u63d0\u6848\u6210\u529f")})["catch"](function(a){console.error("\u6a19\u8a18\u63d0\u6848\u5931\u6557\uff1a",a)})})})["catch"](function(a){console.error("\u66f4\u65b0\u63d0\u6848\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u53d6\u5f97\u63d0\u6848\u805a\u7126\u5167\u8166\u529b\u6fc0\u76ea\u9663\u5217\u767c\u751f\u932f\u8aa4\uff1a",
a)})})})["catch"](function(a){console.log("\u67e5\u8a62\u5168\u90e8\u8a0a\u606f\u767c\u751f\u932f\u8aa4\uff1a",a)})}}]}):n.show({title:"\u5efa\u8b70\u52a0\u5165\u4e4b\u8166\u529b\u6fc0\u76ea",subTitle:"\u5efa\u8b70\u5f8c\u9700\u7b49\u904e\u534a\u7d44\u54e1\u540c\u610f\u624d\u53ef\u52a0\u5165\u3002",template:'<div ng-repeat="proposalsPerSearch in proposalsForFilter() | filter:searchFilter | orderBy:\'search\'"><div class="item item-divider">\u8166\u529b\u6fc0\u76ea{{proposalsPerSearch.search}}</div><div ng-repeat="proposal in proposals | filter:{search:proposalsPerSearch.search} | orderBy:\'-like\' "><ion-checkbox ng-click="proposalBtn(proposal.ID)">{{proposal.like}}\u8b9a\uff1a{{proposal.msg}}</ion-checkbox></div></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u5efa\u8b70",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u5efa\u8b70");0==a.checkProposals.length?(console.log("\u8acb\u52fe\u9078\u8166\u529b\u6fc0\u76ea"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u52fe\u9078\u81f3\u5c11\u4e00\u9805\u8166\u529b\u6fc0\u76ea\u3002"})):e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).where("time","==",
d).get().then(function(c){c.forEach(function(c){var d=c.id;e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(d).collection("\u5efa\u8b70").add({StuID:f,brainstorming:a.checkProposals,voteY:[f],voteN:[],solve:!1,time:new Date}).then(function(a){console.log("\u65b0\u589ebell\u6210\u529f");e.collection("\u5206\u7d44").doc(g).collection("group").doc(b).get().then(function(a){e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(d).update({bellBadge:a.data().members}).then(function(a){console.log("\u66f4\u65b0\u672a\u8b80\u540d\u55ae\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u672a\u8b80\u540d\u55ae\u5931\u6557\uff1a",
a)})})["catch"](function(a){console.log("\u53d6\u5f97\u5c0f\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)})})["catch"](function(a){console.error("\u65b0\u589ebell\u5931\u6557\uff1a",a)})})})["catch"](function(a){console.log("\u67e5\u8a62\u5168\u90e8\u8a0a\u606f\u767c\u751f\u932f\u8aa4\uff1a",a)})}}]}))};a.DelBrainstorming=function(a,d){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).where("time","==",d).get().then(function(c){c.forEach(function(c){var d=c.id;e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).where("time",
"==",a).get().then(function(a){a.forEach(function(a){var c=a.data().brainstorming;c.splice(c.indexOf(d),1);e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(a.id).update({brainstorming:c}).then(function(a){console.log("\u66f4\u65b0\u8a72\u63d0\u6848\u4e4b\u8166\u529b\u6fc0\u76ea\u6e05\u55ae\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u8a72\u63d0\u6848\u4e4b\u8166\u529b\u6fc0\u76ea\u6e05\u55ae\u5931\u6557\uff1a",a)});e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(d).update({invited:!1}).then(function(a){console.log("\u6a19\u8a18\u63d0\u6848\u6210\u529f")})["catch"](function(a){console.error("\u6a19\u8a18\u63d0\u6848\u5931\u6557\uff1a",
a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u8a72\u63d0\u6848\u4e4b\u8166\u529b\u6fc0\u76ea\u6e05\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u8166\u529b\u6fc0\u76eaID\u767c\u751f\u932f\u8aa4\uff1a",a)})};a.DelProposal=function(a){n.confirm({title:"\u522a\u9664\u63d0\u6848",template:"\u78ba\u5b9a\u8981\u522a\u9664\u6b64\u63d0\u6848\u55ce?",buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},
{text:"\u78ba\u5b9a",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u522a\u9664");e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).where("time","==",a).get().then(function(a){a.forEach(function(a){e.collection("\u63d0\u6848\u805a\u7126").doc(g).collection(b).doc(a.id)["delete"]().then(function(){console.log("\u522a\u9664\u63d0\u6848\u805a\u7126\u6210\u529f");a.data().brainstorming.forEach(function(a){e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).collection(b).doc(a).update({invited:!1}).then(function(a){console.log("\u6a19\u8a18\u63d0\u6848\u6210\u529f")})["catch"](function(a){console.error("\u6a19\u8a18\u63d0\u6848\u5931\u6557\uff1a",
a)})});e.collection("\u8166\u529b\u6fc0\u76ea").doc(g).set({update:new Date}).then(function(a){console.log("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u6559\u5e2b\u4e3b\u63a7\u53f0\u5931\u6557\uff1a",a)})})["catch"](function(a){console.error("\u522a\u9664\u63d0\u6848\u805a\u7126\u5931\u6557\uff1a",a)})})})["catch"](function(a){console.log("\u67e5\u8a62\u5168\u90e8\u8a0a\u606f\u767c\u751f\u932f\u8aa4\uff1a",a)})}}]})}}else console.log("\u5c1a\u672a\u767b\u5165"),
p.go("login")})}]).controller("settingCtrl",["$scope","$stateParams","$ionicLoading","$ionicPopup",function(a,r,p,n){var l=firebase.firestore();firebase.auth().onAuthStateChanged(function(q){if(q){console.log("\u5df2\u767b\u5165\u72c0\u614b");var e=q.email.substring(0,q.email.indexOf("@")).toUpperCase(),k=localStorage.getItem("ClassID");a.Passward=function(){n.show({title:"\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1",template:"\u78ba\u5b9a\u8981\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u55ce?",buttons:[{text:"\u53d6\u6d88",
type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u78ba\u5b9a",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u78ba\u5b9a");p.show({template:"\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u4e2d..."});firebase.auth().sendPasswordResetEmail(e+"@nkust.edu.tw").then(function(){console.log("\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u6210\u529f");n.alert({title:"\u6210\u529f",template:"\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u6210\u529f\uff0c\u8acb\u81f3 "+
e+"@nkust.edu.tw \u6536\u4fe1"});p.hide()})["catch"](function(a){console.log("\u5bc4\u9001\u5bc6\u78bc\u91cd\u7f6e\u4fe1\u5931\u6557\uff1a",a);p.hide()})}}]})};a.myImage="";a.myCroppedImage="";angular.element(document.querySelector("#uploadFileInput2")).on("change",function(e){e=e.currentTarget.files[0];var g=new FileReader;g.onload=function(b){a.$apply(function(a){a.myImage=b.target.result})};g.readAsDataURL(e)});a.ChangeImg=function(f){p.show({template:"\u4e0a\u50b3\u5716\u7247\u4e2d..."});if(""==
f)console.log("\u672a\u9078\u64c7\u6a94\u6848"),p.hide(),n.alert({title:"\u672a\u9078\u64c7\u6a94\u6848",template:"\u8acb\u5148\u9078\u64c7\u6a94\u6848\u518d\u4e0a\u50b3"});else{var g=firebase.storage().ref(),b=new Date,d=e+b.getFullYear().toString()+b.getMonth()+b.getDate()+b.getHours()+b.getMinutes()+b.getSeconds()+b.getMilliseconds();g.child("members/"+d).putString(f,"data_url").on("state_changed",function(a){p.show({template:"\u5df2\u4e0a\u50b3 "+a.bytesTransferred/a.totalBytes*100+"%"});switch(a.state){case firebase.storage.TaskState.PAUSED:console.log("\u4e0a\u50b3\u66ab\u505c");
break;case firebase.storage.TaskState.RUNNING:console.log("\u4e0a\u50b3\u4e2d")}},function(b){console.log("\u4e0a\u50b3\u5931\u6557");p.hide();console.log(b);n.alert({title:"\u4e0a\u50b3\u5716\u7247\u5931\u6557",template:b});a.myImage="";a.myCroppedImage=""},function(){console.log("\u4e0a\u50b3\u6210\u529f");p.hide();a.myImage="";a.myCroppedImage="";g.child("members/"+d).getDownloadURL().then(function(a){document.getElementById("menu-img").src=a});l.collection("\u5e33\u865f").doc(e).update({Img:d}).then(function(a){console.log("\u66f4\u65b0DB\u6a94\u540d\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0DB\u6a94\u540d\u5931\u6557\uff1a",
a)});"none"!=localStorage.getItem("GroupID")&&l.collection("\u5206\u7d44").doc(k).collection("group").doc(localStorage.getItem("GroupID")).update({imgChange:new Date}).then(function(a){console.log("\u901a\u77e5\u9996\u9801\u66f4\u63db\u7167\u7247\u6210\u529f")})["catch"](function(a){console.error("\u901a\u77e5\u9996\u9801\u66f4\u63db\u7167\u7247\u5931\u6557\uff1a",a)});n.alert({title:"\u6210\u529f",template:"\u66f4\u63db\u7167\u7247\u5b8c\u6210\u3002"})})}};a.BugBtn=function(a){""==a||void 0==a?(console.log("\u8acb\u586b\u5beb\u5b8c\u6574"),
n.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u5b8c\u6574\u3002"})):l.collection("\u7cfb\u7d71\u8a18\u9304").doc(k).collection("BUG\u56de\u5831").add({StuID:e,Content:a,time:new Date}).then(function(a){console.log("\u56de\u50b3\u4f3a\u670d\u5668\u6210\u529f");n.alert({title:"\u6210\u529f",template:"\u56de\u5831\u6210\u529f\uff0c\u611f\u8b1d\u60a8\u3002"})})["catch"](function(a){console.error("\u56de\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",a);n.alert({title:"\u5931\u6557",template:"\u56de\u5831\u5931\u6557\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\u3002"+
a})})}}else console.log("\u5c1a\u672a\u767b\u5165"),$state.go("login")})}]).controller("menuCtrl",["$scope","$stateParams","$ionicPopup","$state",function(a,r,p,n){var l=firebase.firestore();firebase.auth().onAuthStateChanged(function(q){if(q){console.log("\u5df2\u767b\u5165\u72c0\u614b");var e=q.email.substring(0,q.email.indexOf("@")).toUpperCase(),k=localStorage.getItem("ClassID");l.collection("\u5e33\u865f").doc(e).get().then(function(a){document.getElementById("menu-heading1").innerText=e+" "+
a.data().Name;localStorage.setItem("StuName",a.data().Name)})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});document.getElementById("menu-list-item8").addEventListener("click",function(){firebase.auth().signOut().then(function(){console.log("\u767b\u51fa\u6210\u529f");localStorage.clear()})["catch"](function(a){console.log("\u767b\u51fa\u767c\u751f\u932f\u8aa4!")})},!1);l.collection("\u5e33\u865f").doc(e).get().then(function(a){console.log("\u66f4\u65b0\u5927\u982d\u7167\u6210\u529f");
firebase.storage().ref().child("members/"+a.data().Img).getDownloadURL().then(function(a){document.getElementById("menu-img").src=a})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});document.getElementById("menu-heading2").innerText="Copyright \u00a9 2019 ver "+verson;l.collection("\u5206\u7d44").doc(k).collection("student").doc(e).collection("invite").where("respond","==",!1).onSnapshot(function(g){g.docChanges().forEach(function(b){if("added"===
b.type){b=b.doc;console.log("\u6709\u4eba\u9080\u8acb");var d=b.data().groupID,h=b.id,c=b.data().leader;l.collection("\u5e33\u865f").doc(c).get().then(function(b){b=b.data().Name;var g=p.show({title:"\u5c0f\u7d44\u9080\u8acb",subTitle:c+" "+b+" \u9080\u8acb\u4f60\u52a0\u5165\u5c0f\u7d44\u3002",template:'<img class="inviteImg" src="img/invite.jpg">',scope:a,buttons:[{text:"\u62d2\u7d55",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u62d2\u7d55");l.collection("\u5206\u7d44").doc(k).collection("student").doc(e).collection("invite").doc(h).update({respond:!0}).then(function(a){console.log("\u66f4\u65b0\u56de\u61c9\u72c0\u614b\u6210\u529f");
l.collection("\u5206\u7d44").doc(k).collection("group").doc(d).get().then(function(a){a=a.data().inviting;a.splice(a.indexOf(e),1);l.collection("\u5206\u7d44").doc(k).collection("group").doc(d).update({inviting:a}).then(function(a){console.log("\u66f4\u65b0inviting\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0inviting\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u6aa2\u67e5\u5c0f\u7d44\u662f\u5426\u9084\u5b58\u5728\uff0c\u53ef\u80fd\u5c0f\u7d44\u5df2\u89e3\u6563\uff1a",
a)})})["catch"](function(a){console.error("\u66f4\u65b0\u56de\u61c9\u72c0\u614b\u5931\u6557\uff1a",a)})}},{text:"\u63a5\u53d7",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u63a5\u53d7");l.collection("\u5206\u7d44").doc(k).collection("student").doc(e).collection("invite").doc(h).update({respond:!0}).then(function(a){console.log("\u66f4\u65b0\u56de\u61c9\u72c0\u614b\u6210\u529f");l.collection("\u5206\u7d44").doc(k).collection("student").doc(e).update({grouped:!0}).then(function(a){console.log("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u6210\u529f");
l.collection("\u5206\u7d44").doc(k).collection("group").doc(d).get().then(function(a){var b=a.data().inviting;a=a.data().members;b.splice(b.indexOf(e),1);a.push(e);l.collection("\u5206\u7d44").doc(k).collection("group").doc(d).update({inviting:b,members:a}).then(function(a){console.log("\u66f4\u65b0inviting\u6210\u529f");l.collection("\u5206\u7d44").doc(k).collection("student").doc(e).collection("invite").where("respond","==",!1).get().then(function(a){a.forEach(function(a){l.collection("\u5206\u7d44").doc(k).collection("student").doc(e).collection("invite").doc(a.id).update({respond:!0}).then(function(a){console.log("\u62d2\u7d55\u5176\u4ed6\u9080\u8acb - \u66f4\u65b0\u56de\u61c9\u72c0\u614b\u6210\u529f");
l.collection("\u5206\u7d44").doc(k).collection("group").doc(d).get().then(function(a){a=a.data().inviting;a.splice(a.indexOf(e),1);l.collection("\u5206\u7d44").doc(k).collection("group").doc(d).update({inviting:a}).then(function(a){console.log("\u66f4\u65b0inviting\u6210\u529f");window.location.reload()})["catch"](function(a){console.error("\u66f4\u65b0inviting\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u6aa2\u67e5\u5c0f\u7d44\u662f\u5426\u9084\u5b58\u5728\uff0c\u53ef\u80fd\u5c0f\u7d44\u5df2\u89e3\u6563\uff1a",
a)})})["catch"](function(a){console.error("\u62d2\u7d55\u5176\u4ed6\u9080\u8acb - \u66f4\u65b0\u56de\u61c9\u72c0\u614b\u5931\u6557\uff1a",a)})})});for(a=0;10>a;a++)g.close()})["catch"](function(a){console.error("\u66f4\u65b0inviting\u5931\u6557\uff1a",a)})})["catch"](function(a){console.log("\u6aa2\u67e5\u5c0f\u7d44\u662f\u5426\u9084\u5b58\u5728\uff0c\u53ef\u80fd\u5c0f\u7d44\u5df2\u89e3\u6563\uff1a",a)})})["catch"](function(a){console.error("\u66f4\u65b0\u5165\u7d44\u72c0\u614b\u5931\u6557\uff1a",
a)})})["catch"](function(a){console.error("\u66f4\u65b0\u56de\u61c9\u72c0\u614b\u5931\u6557\uff1a",a)})}}]})})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})}})},function(a){console.log("\u641c\u5c0b\u662f\u5426\u6709\u4eba\u9080\u8acb\u767c\u751f\u932f\u8aa4\uff1a",a)});l.collection("\u5206\u7d44").doc(k).collection("group").where("members","array-contains",e).onSnapshot(function(g){0==g.empty?(console.log("\u9078\u55ae - \u5df2\u52a0\u5165\u5c0f\u7d44"),
g.forEach(function(b){localStorage.setItem("GroupID",b.id);GroupID=b.id;a.needGroup=!0;l.collection("\u9ede\u6578").doc(k).collection(e).doc("\u5c0f\u4efb\u52d9\u9032\u5ea6").collection("\u5c0f\u4efb\u52d9\u9032\u5ea6").doc("SmallTask1").set({schedule:1,time:new Date}).then(function(a){console.log("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u5c0f\u4efb\u52d9\u9032\u5ea6\u5931\u6557\uff1a",a)})})):(console.log("\u9078\u55ae - \u672a\u52a0\u5165\u5c0f\u7d44"),
localStorage.setItem("GroupID","none"),GroupID="none",a.needGroup=!1)},function(a){console.log("\u53d6\u5f97\u5c0f\u7d44ID\u767c\u751f\u932f\u8aa4\uff1a",a)});var f=[];l.collection("\u9ede\u6578").doc(k).collection(e).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").onSnapshot(function(g){g.docChanges().forEach(function(b){if("added"===b.type){var d=pasw(b.doc.data().point);"ER"==d?l.collection("\u7cfb\u7d71\u8a18\u9304").doc(k).collection("\u8cc7\u5b89\u56de\u5831").add({StuID:e,
Content:"\u9ede\u6578\u89e3\u5bc6\u767c\u751f\u932f\u8aa4",time:new Date}).then(function(a){console.log("\u901a\u5831\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u901a\u5831\u4f3a\u670d\u5668\u5931\u6557\uff1a",a)}):f.push({point:d,time:b.doc.data().time});console.log("\u65b0\u589e: ",b.doc.data());a.$apply()}else"modified"===b.type?console.log("\u4fee\u6539: ",b.doc.data()):"removed"===b.type&&(console.log("\u522a\u9664: ",b.doc.data()),d=f.findIndex(function(a){return a.time.seconds===
b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=d?(f.splice(d,1),console.log("\u522a\u9664\u9ede\u6578\u6210\u529f")):console.log("\u522a\u9664\u9ede\u6578\u4e0d\u6210\u529f"),a.$apply());for(var h=d=0;h<f.length;h++)d+=f[h].point,h==f.length-1&&(a.TotalPoint=d,l.collection("\u9ede\u6578").doc(k).collection(e).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").set({Point:paswLock(d)}).then(function(a){console.log("\u66f4\u65b0\u4f3a\u670d\u5668\u9ede\u6578\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0\u4f3a\u670d\u5668\u9ede\u6578\u5931\u6557\uff1a",
a)}))})})}else console.log("\u5c1a\u672a\u767b\u5165"),n.go("login")})}]).controller("root_pblCtrl",["$scope","$stateParams","$ionicPopup","$ionicLoading","$state",function(a,r,p,n,l){firebase.auth().onAuthStateChanged(function(q){if("eTlMITVmGbSStEQ7B7jw9rIl20N2"===q.uid){console.log("\u5df2\u767b\u5165\u72c0\u614b");var e=firebase.auth().currentUser,k=[];$("#excel-file").change(function(a){a=a.target.files;var b=new FileReader;b.onload=function(a){try{var b=XLSX.read(a.target.result,{type:"binary"})}catch(m){console.log("\u6a94\u6848\u578b\u5225\u4e0d\u6b63\u78ba");
return}for(var c in b.Sheets)b.Sheets.hasOwnProperty(c)&&(a=b.Sheets[c]["!ref"],console.log(a),k=k.concat(XLSX.utils.sheet_to_json(b.Sheets[c])));console.log(k)};b.readAsBinaryString(a[0])});var f=firebase.firestore();a.addClass=function(){var a=this.className;void 0===a||""===a||0===k.length?(console.log("\u672a\u586b"),p.alert({title:"\u932f\u8aa4",template:"\u8cc7\u6599\u672a\u586b\u5b8c\u6574\u3002"})):p.confirm({title:"\u5275\u7acb\u8ab2\u7a0b",template:"\u78ba\u5b9a\u5275\u7acb\u55ce?"}).then(function(b){if(b){console.log("\u78ba\u5b9a");
n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u5275\u7acb\u8ab2\u7a0b\u4e2d...</p>'});b=[];for(var d=0;d<k.length;d++)b.push(k[d].\u5b78\u865f);f.collection("\u8ab2\u7a0b").add({ClassName:a,ClassContent:"\u66ab\u7121\u516c\u544a\u3002",inviteLock:!1,lock:!1,maxMembers:6,ClassStu:b}).then(function(a){console.log("\u65b0\u589e\u8ab2\u7a0b\u6210\u529f");var b=f.batch();b.update(f.collection("\u8ab2\u7a0b").doc(a.id),{ClassID:a.id});for(var d={$jscomp$loop$prop$index$3$16:0};d.$jscomp$loop$prop$index$3$16<
k.length;d={$jscomp$loop$prop$index$3$16:d.$jscomp$loop$prop$index$3$16},d.$jscomp$loop$prop$index$3$16++)f.collection("\u5e33\u865f").doc(k[d.$jscomp$loop$prop$index$3$16].\u5b78\u865f).get().then(function(c){return function(d){d.exists?(console.log("\u5df2\u6709\u5e33\u865f"),b.set(f.collection("\u5206\u7d44").doc(a.id).collection("student").doc(k[c.$jscomp$loop$prop$index$3$16].\u5b78\u865f),{grouped:!1}),c.$jscomp$loop$prop$index$3$16===k.length-1&&b.commit().then(function(){console.log("\u66f4\u65b0\u5b78\u751f\u6210\u529f");
k=[];n.hide()})["catch"](function(a){console.error("\u66f4\u65b0\u5b78\u751f\u8cc7\u6599\u5931\u6557\uff1a",a)})):(console.log("\u5c1a\u7121\u5e33\u865f"),b.set(f.collection("\u5e33\u865f").doc(k[c.$jscomp$loop$prop$index$3$16].\u5b78\u865f),{Name:k[c.$jscomp$loop$prop$index$3$16].\u59d3\u540d},{Img:"default"}),b.set(f.collection("\u5206\u7d44").doc(a.id).collection("student").doc(k[c.$jscomp$loop$prop$index$3$16].\u5b78\u865f),{grouped:!1}),firebase.auth().createUserWithEmailAndPassword(k[c.$jscomp$loop$prop$index$3$16].\u5b78\u865f+
"@nkust.edu.tw",k[c.$jscomp$loop$prop$index$3$16].\u5b78\u865f).then(function(){console.log("\u8a3b\u518aAuthentication\u6210\u529f");firebase.auth().updateCurrentUser(e)})["catch"](function(a){console.log("\u8a3b\u518aAuthentication\u5931\u6557",a.message)}),c.$jscomp$loop$prop$index$3$16===k.length-1&&b.commit().then(function(){console.log("\u66f4\u65b0\u5b78\u751f\u6210\u529f");k=[];n.hide()})["catch"](function(a){console.error("\u66f4\u65b0\u5b78\u751f\u8cc7\u6599\u5931\u6557\uff1a",a)}))}}(d))["catch"](function(a){console.log("\u5224\u65b7\u5e33\u865f\u767c\u751f\u932f\u8aa4\uff1a",
a)})})["catch"](function(a){console.error("\u65b0\u589e\u8ab2\u7a0b\u5931\u6557\uff1a",a)})}else console.log("\u53d6\u6d88")})};f.collection("\u8ab2\u7a0b").get().then(function(e){a.AllClass=[];e.forEach(function(b){a.AllClass.push(b.data());a.$apply()})});a.SelectBtn=function(e){if(void 0!=e){var b=e.ClassID;a.cardShow=!0;a.LockGroupChange=function(a,b){f.collection("\u8ab2\u7a0b").doc(a).update({inviteLock:b}).then(function(a){console.log("\u66f4\u65b0inviteLock\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0inviteLock\u5931\u6557\uff1a",
a)})};a.maxMembersChange=function(a,b){f.collection("\u8ab2\u7a0b").doc(a).update({maxMembers:b}).then(function(a){console.log("\u66f4\u65b0maxMembers\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0maxMembers\u5931\u6557\uff1a",a)})};f.collection("\u5206\u7d44").doc(b).collection("student").where("grouped","==",!1).onSnapshot(function(c){a.thisClass=e;a.Allgroups=[];var d=[];f.collection("\u5206\u7d44").doc(b).collection("student").where("grouped","==",!1).get().then(function(c){c.forEach(function(a){f.collection("\u5e33\u865f").doc(a.id).get().then(function(b){d.push(a.id+
b.data().Name)})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})});var h=[];f.collection("\u5206\u7d44").doc(b).collection("student").where("grouped","==",!0).get().then(function(b){b.forEach(function(a){h.push(a.id)});a.Allgroups=[{ClassName:e.ClassName,Ngroup:d,Ygroup:h}];b=document.getElementById("Chart_group");b=echarts.init(b);option=null;(option={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["\u672a\u5206\u7d44",
"\u5df2\u5206\u7d44"]},series:[{name:"\u5206\u7d44\u72c0\u614b",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"15",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:d.length,name:"\u672a\u5206\u7d44"},{value:h.length,name:"\u5df2\u5206\u7d44"}]}]},"object"===typeof option)&&b.setOption(option,!0);a.cardShow=!0;n.hide();l.go(l.current,{},{reload:!0})})})});var d=[],h=[],c=[],g=[];f.collection("\u5206\u7d44").doc(b).collection("student").where("grouped",
"==",!1).onSnapshot(function(a){d=[];f.collection("\u5206\u7d44").doc(b).collection("group").orderBy("leader","asc").get().then(function(a){a.forEach(function(b){d.push(b.data().leader);if(a.docs[a.docs.length-1].id==b.id)for(b={$jscomp$loop$prop$index$18:0};b.$jscomp$loop$prop$index$18<d.length;b={$jscomp$loop$prop$index$18:b.$jscomp$loop$prop$index$18},b.$jscomp$loop$prop$index$18++)f.collection("\u5e33\u865f").doc(d[b.$jscomp$loop$prop$index$18]).get().then(function(a){return function(b){d[a.$jscomp$loop$prop$index$18]=
b.data().Name+"\u7d44";k(d,h,c,g)}}(b))})})});f.collection("\u8166\u529b\u6fc0\u76ea").doc(b).onSnapshot(function(a){h=[];f.collection("\u5206\u7d44").doc(b).collection("group").orderBy("leader","asc").get().then(function(a){a.forEach(function(a){f.collection("\u8166\u529b\u6fc0\u76ea").doc(b).collection(a.id).get().then(function(a){h.push(a.docs.length-1);k(d,h,c,g)})})})});f.collection("\u63d0\u6848\u805a\u7126").doc(b).onSnapshot(function(a){c=[];f.collection("\u5206\u7d44").doc(b).collection("group").orderBy("leader",
"asc").get().then(function(a){a.forEach(function(a){f.collection("\u63d0\u6848\u805a\u7126").doc(b).collection(a.id).get().then(function(a){c.push(a.docs.length);k(d,h,c,g)})})})});f.collection("\u6295\u7968").doc(b).onSnapshot(function(a){g=[];f.collection("\u5206\u7d44").doc(b).collection("group").orderBy("leader","asc").get().then(function(a){a.forEach(function(a){f.collection("\u6295\u7968").doc(b).collection(a.id).get().then(function(a){g.push(a.docs.length);k(d,h,c,g)})})})});var k=function(a,
b,c,d){var h=echarts.init(document.getElementById("Chart_discuss"));option=null;(option={tooltip:{trigger:"axis"},legend:{data:["\u8166\u529b\u6fc0\u76ea\u6578","\u63d0\u6848\u805a\u7126\u6578","\u6295\u7968\u6578"]},toolbox:{show:!0},calculable:!0,xAxis:[{type:"category",data:a}],yAxis:[{type:"value"}],series:[{name:"\u8166\u529b\u6fc0\u76ea\u6578",type:"bar",data:b,markPoint:{data:[{type:"max",name:"\u6700\u5927\u503c"},{type:"min",name:"\u6700\u5c0f\u503c"}]},markLine:{data:[{type:"average",name:"\u5e73\u5747\u503c"}]}},
{name:"\u63d0\u6848\u805a\u7126\u6578",type:"bar",data:c,markPoint:{data:[{type:"max",name:"\u6700\u5927\u503c"},{type:"min",name:"\u6700\u5c0f\u503c"}]},markLine:{data:[{type:"average",name:"\u5e73\u5747\u503c"}]}},{name:"\u6295\u7968\u6578",type:"bar",data:d,markPoint:{data:[{type:"max",name:"\u6700\u5927\u503c"},{type:"min",name:"\u6700\u5c0f\u503c"}]},markLine:{data:[{type:"average",name:"\u5e73\u5747\u503c"}]}}]},"object"===typeof option)&&h.setOption(option,!0)};f.collection("\u9ede\u6578").doc(b).onSnapshot(function(b){a.PointTops=
[];for(var c={$jscomp$loop$prop$index$20:0};c.$jscomp$loop$prop$index$20<b.data().top.length;c={$jscomp$loop$prop$index$20:c.$jscomp$loop$prop$index$20},c.$jscomp$loop$prop$index$20++)f.collection("\u5e33\u865f").doc(b.data().top[c.$jscomp$loop$prop$index$20].StuID).get().then(function(c){return function(d){firebase.storage().ref().child("members/"+d.data().Img).getDownloadURL().then(function(h){a.PointTops.push({Name:d.data().Name,Img:h,Point:b.data().top[c.$jscomp$loop$prop$index$20].Point});a.$apply()})}}(c))["catch"](function(a){console.log("\u67e5\u8a62\u5e33\u865f\u8cc7\u6599\u767c\u751f\u932f\u8aa4\uff1a",
a)})},function(a){console.error("\u8b80\u53d6\u9ede\u6578\u6392\u884c\u699c\u767c\u751f\u932f\u8aa4\uff1a",a)});a.StuPoints=[];f.collection("\u8ab2\u7a0b").doc(b).get().then(function(c){c.data().ClassStu.forEach(function(c){f.collection("\u9ede\u6578").doc(b).collection(c).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").get().then(function(b){var d=0,h=b.docs.length,e=0,g=[];b.forEach(function(b){-1!=g.indexOf(b.data().check)?(console.log(c+"\u767c\u73fe\u91cd\u8907"),
p.alert({title:c+"\u767c\u73fe\u91cd\u8907",template:"\u7de8\u865f\uff1a"+b.id})):g.push(b.data().check);d+=pasw(b.data().point);e++;e==h&&(n.hide(),f.collection("\u5e33\u865f").doc(c).get().then(function(b){a.StuPoints.push({Name:c+" "+b.data().Name,StuID:c,Point:d});a.$apply()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)}))})})["catch"](function(a){console.log("\u8f09\u5165\u7e3d\u9ede\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u8ab2\u7a0b\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",
a)});a.AddBtn=function(c){a.Stus=[];n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u5b78\u751f\u4e2d...</p>'});f.collection("\u5206\u7d44").doc(b).collection("student").get().then(function(b){b.forEach(function(c){var d=b.docs[b.docs.length-1].id,h=b.docs[b.docs.length-2].id;f.collection("\u5e33\u865f").doc(c.id).get().then(function(b){a.Stus.push({StuID:c.id,Name:b.data().Name,Checked:!1});c.id!=d&&c.id!=h||n.hide()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",
a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});a.checkStus=[];a.check=function(b){-1===a.checkStus.indexOf(b)?a.checkStus.push(b):a.checkStus.splice(a.checkStus.indexOf(b),1);console.log(a.checkStus)};a.AddBtnPopup=[];p.show({title:"\u767c\u653e\u9ede\u6578",template:'<label class="item item-input item-input"><div class="input-label">\u9ede\u6578\u8aaa\u660e</div><input type="text" ng-model="AddBtnPopup.content" placeholder="\u8f38\u5165\u8aaa\u660e"></label><label class="item item-input item-input"><div class="input-label">\u9ede\u6578\u6578\u91cf</div><input type="number" ng-model="AddBtnPopup.point" placeholder="\u8f38\u5165\u6578\u5b57"></label><label class="item item-input item-select"><div class="input-label">\u767c\u653e\u65e5\u671f</div><input type="date" ng-model="AddBtnPopup.time"></label><div ng-repeat="Stu in Stus"><ion-checkbox ng-model="Stu.Checked" ng-click="check(Stu.StuID)">{{Stu.StuID}} {{Stu.Name}}</ion-checkbox></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u767c\u653e",type:"button-chanry1",onTap:function(c){console.log("\u9078\u64c7\u767c\u653e");if(void 0==a.AddBtnPopup.content||void 0==a.AddBtnPopup.point||void 0==a.AddBtnPopup.time)console.log("\u8acb\u586b\u5beb\u5b8c\u6574"),p.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u5b8c\u6574\u3002"});else if(0==a.checkStus.length)console.log("\u8acb\u81f3\u5c11\u52fe\u4e00\u4f4d"),
p.alert({title:"\u932f\u8aa4",template:"\u8acb\u81f3\u5c11\u52fe\u4e00\u4f4d\u3002"});else{c=new Date;c=c.getFullYear().toString()+c.getMonth()+c.getDate()+c.getHours()+c.getMinutes()+c.getSeconds()+c.getMilliseconds();for(var d=0;d<a.checkStus.length;d++)f.collection("\u9ede\u6578").doc(b).collection(a.checkStus[d]).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:a.AddBtnPopup.content,point:paswLock(a.AddBtnPopup.point),check:c,time:a.AddBtnPopup.time}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",
a)})}}}]})};a.update=function(){a.StuPoints=a.StuPoints.sort(function(a,b){return a.Point<b.Point?1:-1});for(var c=[],d=0;5>d;d++)c.push({StuID:a.StuPoints[d].StuID,Point:a.StuPoints[d].Point});f.collection("\u9ede\u6578").doc(b).set({top:c,UpdateTime:new Date}).then(function(a){console.log("\u66f4\u65b0\u6392\u884c\u699c\u6210\u529f");p.alert({title:"\u5b8c\u6210",template:"\u66f4\u65b0\u6392\u884c\u699c\u6210\u529f\u3002<br>\u7b2c\u4e00\u540d "+c[0].StuID+" \u5171 "+c[0].Point+"\u9ede<br>\u7b2c\u4e8c\u540d "+
c[1].StuID+" \u5171 "+c[1].Point+"\u9ede<br>\u7b2c\u4e09\u540d "+c[2].StuID+" \u5171 "+c[2].Point+"\u9ede<br>\u7b2c\u56db\u540d "+c[3].StuID+" \u5171 "+c[3].Point+"\u9ede<br>\u7b2c\u4e94\u540d "+c[4].StuID+" \u5171 "+c[4].Point+"\u9ede"})})["catch"](function(a){console.error("\u66f4\u65b0\u6392\u884c\u699c\u5931\u6557\uff1a",a);p.alert({title:"\u932f\u8aa4",template:"\u66f4\u65b0\u6392\u884c\u699c\u5931\u6557\u3002"})})};a.messages=[];f.collection("\u7559\u8a00\u7248").doc(b).collection("messages").orderBy("time",
"asc").onSnapshot(function(b){b.docChanges().forEach(function(b){"added"===b.type&&f.collection("\u5e33\u865f").doc(b.doc.data().StuID).get().then(function(c){firebase.storage().ref().child("members/"+c.data().Img).getDownloadURL().then(function(c){a.messages.push({messageName:b.doc.data().StuID+" "+b.doc.data().StuName,messageImg:c,messageContent:b.doc.data().content,time:b.doc.data().time});a.$apply();c=document.getElementById("scroll_doc");c.scrollTop=c.scrollHeight})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",
a)});"modified"===b.type&&console.log("\u4fee\u6539: ",b.doc.data());"removed"===b.type&&console.log("\u522a\u9664: ",b.doc.data())})});a.messages2=[];f.collection("\u533f\u540d\u7559\u8a00\u7248").doc(b).collection("messages").orderBy("time","asc").onSnapshot(function(b){b.docChanges().forEach(function(b){"added"===b.type&&f.collection("\u5e33\u865f").doc(b.doc.data().StuID).get().then(function(c){firebase.storage().ref().child("members/"+c.data().Img).getDownloadURL().then(function(c){var d="\u533f\u540d",
h="https://firebasestorage.googleapis.com/v0/b/co-writing-test.appspot.com/o/members%2Fdefault?alt=media&token=e511b185-cd79-47e2-b501-e026fd8da387";"ROOT"==b.doc.data().StuID&&(d=b.doc.data().StuID+" "+b.doc.data().StuName,h=c);a.messages2.push({messageName:d,messageImg:h,messageContent:b.doc.data().content,time:b.doc.data().time});a.$apply();c=document.getElementById("scroll_doc2");c.scrollTop=c.scrollHeight})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",
a)});"modified"===b.type&&console.log("\u4fee\u6539: ",b.doc.data());"removed"===b.type&&console.log("\u522a\u9664: ",b.doc.data())})});a.addMessage=function(c,d){n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u65b0\u589e\u4e2d...</p>'});console.log("1");2==c?void 0!=d&&""!=d&&(f.collection("\u533f\u540d\u7559\u8a00\u7248").doc(b).collection("messages").add({StuID:"ROOT",StuName:"\u5289\u52c7\u5fd7 \u8001\u5e2b",content:d,time:new Date}).then(function(a){console.log("\u65b0\u589e\u7559\u8a00\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589e\u7559\u8a00\u5931\u6557\uff1a",
a)}),a.inputMessage2=""):1==c&&(console.log("2"+d),void 0!=d&&""!=d&&(f.collection("\u7559\u8a00\u7248").doc(b).collection("messages").add({StuID:"ROOT",StuName:"\u5289\u52c7\u5fd7 \u8001\u5e2b",content:d,time:new Date}).then(function(a){console.log("\u65b0\u589e\u7559\u8a00\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589e\u7559\u8a00\u5931\u6557\uff1a",a)}),a.inputMessage=""));n.hide()}}else p.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u8ab2\u7a0b\u3002"})}}else console.log("\u975e\u7ba1\u7406\u54e1"),
l.go("login")})}]).controller("root_groupCtrl",["$scope","$stateParams","$state","$ionicLoading",function(a,r,p,n){var l=firebase.firestore();firebase.auth().onAuthStateChanged(function(q){"eTlMITVmGbSStEQ7B7jw9rIl20N2"===q.uid?(console.log("\u5df2\u767b\u5165\u72c0\u614b"),a.cardShow=!1,l.collection("\u8ab2\u7a0b").get().then(function(e){a.AllClass=[];e.forEach(function(e){a.AllClass.push(e.data());p.go(p.current,{},{reload:!0})})}),a.choose_class=function(e,k){a.cardShow=!1;n.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u8cc7\u6599\u4e2d...</p>'});
var f=a.AllClass.findIndex(function(a){return a.ClassID===e});a.thisClass=a.AllClass[f];console.log(a.thisClass);a.Allgroups=[];var g=[];l.collection("\u5206\u7d44").doc(e).collection("student").where("grouped","==",!1).get().then(function(b){b.forEach(function(a){l.collection("\u5e33\u865f").doc(a.id).get().then(function(b){g.push(a.id+b.data().Name)})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})});var d=[];l.collection("\u5206\u7d44").doc(e).collection("student").where("grouped",
"==",!0).get().then(function(b){b.forEach(function(a){d.push(a.id)});a.Allgroups=[{ClassName:k,Ngroup:g,Ygroup:d}];b=document.getElementById("Chart_group");b=echarts.init(b);option=null;(option={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["\u672a\u5206\u7d44","\u5df2\u5206\u7d44"]},series:[{name:"\u5206\u7d44\u72c0\u614b",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"15",
fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:g.length,name:"\u672a\u5206\u7d44"},{value:d.length,name:"\u5df2\u5206\u7d44"}]}]},"object"===typeof option)&&b.setOption(option,!0);a.cardShow=!0;n.hide();p.go(p.current,{},{reload:!0})})});a.Allgroups2=[];l.collection("\u5206\u7d44").doc(e).collection("group").get().then(function(b){b.forEach(function(b){for(var d=b.data(),c={$jscomp$loop$prop$index$22:0};c.$jscomp$loop$prop$index$22<b.data().members.length;c={$jscomp$loop$prop$index$22:c.$jscomp$loop$prop$index$22},
c.$jscomp$loop$prop$index$22++)l.collection("\u5e33\u865f").doc(b.data().members[c.$jscomp$loop$prop$index$22]).get().then(function(a){return function(b){d.members[a.$jscomp$loop$prop$index$22]+=b.data().Name}}(c))["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});a.Allgroups2.push(d);p.go(p.current,{},{reload:!0})})})},a.LockGroupChange=function(a,k){l.collection("\u8ab2\u7a0b").doc(a).update({inviteLock:k}).then(function(a){console.log("\u66f4\u65b0inviteLock\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0inviteLock\u5931\u6557\uff1a",
a)})},a.maxMembersChange=function(a,k){l.collection("\u8ab2\u7a0b").doc(a).update({maxMembers:k}).then(function(a){console.log("\u66f4\u65b0maxMembers\u6210\u529f")})["catch"](function(a){console.error("\u66f4\u65b0maxMembers\u5931\u6557\uff1a",a)})}):(console.log("\u5c1a\u672a\u767b\u5165"),p.go("login"))})}]).controller("root_missionCtrl",["$scope","$stateParams","$state","$ionicPopup","$sce",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){"eTlMITVmGbSStEQ7B7jw9rIl20N2"===
e.uid?(console.log("\u5df2\u767b\u5165\u72c0\u614b"),a.cardShow=!1,q.collection("\u8ab2\u7a0b").get().then(function(e){a.AllClass=[];e.forEach(function(e){a.AllClass.push(e.data());p.go(p.current,{},{reload:!0})});console.log(a.AllClass)}),a.hide=function(){a.cardShow=!1},a.SelectBtn=function(e){if(void 0!=e){var f=e.ClassID;a.cardShow=!0;a.missions=[];q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(f).collection("\u4efb\u52d9\u5217\u8868").onSnapshot(function(b){b.docChanges().forEach(function(b){if("added"===
b.type){var d=0;1==b.doc.data().lock?d=3:-1!=b.doc.data().finished.indexOf("\u6559\u5e2b\u7248")?d=1:b.doc.data().TimeOut.toDate()<new Date&&(d=2);var c=Number(b.doc.data().TimeOut.toDate().getMonth())+1;9>=c&&(c="0"+c);var e=b.doc.data().TimeOut.toDate().getDate();9>=e&&(e="0"+e);a.missions.push({missionID:b.doc.id,Name:b.doc.data().Name,Content:b.doc.data().Content,TimeOut:b.doc.data().TimeOut.toDate().getUTCFullYear()+"/"+c+"/"+e,LeaderOnly:b.doc.data().LeaderOnly,type:b.doc.data().type,Point:b.doc.data().Point,
finished:b.doc.data().finished,HTML:l.trustAsHtml(b.doc.data().HTML),time:b.doc.data().time,lock:d,show:!1,isIRS:b.doc.data().isIRS,showMsg:"\u67e5\u770b\u66f4\u591a"});a.$apply();console.log("\u65b0\u589e: ",a.missions)}else"modified"===b.type?(console.log("\u4fee\u6539: ",b.doc.data()),c=a.missions.findIndex(function(a){return a.time.seconds===b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=c?(d=0,1==b.doc.data().lock?d=3:-1!=b.doc.data().finished.indexOf("\u6559\u5e2b\u7248")?
d=1:b.doc.data().TimeOut.toDate()<new Date&&(d=2),a.missions[c].lock=d,console.log("\u4fee\u6539\u4efb\u52d9\u6210\u529f")):console.log("\u4fee\u6539\u4efb\u52d9\u4e0d\u6210\u529f"),a.$apply()):"removed"===b.type&&(console.log("\u522a\u9664: ",b.doc.data()),c=a.missions.findIndex(function(a){return a.time.seconds===b.doc.data().time.seconds&a.time.nanoseconds===b.doc.data().time.nanoseconds}),-1!=c?(a.missions.splice(c,1),console.log("\u522a\u9664\u4efb\u52d9\u6210\u529f")):console.log("\u522a\u9664\u4efb\u52d9\u4e0d\u6210\u529f"),
a.$apply())})});a.AddBtn=function(b){a.AddBtnPopup=[];a.AddBtnPopup.IRS=[];a.AddBtnPopup.LeaderOnly=!1;a.AddBtnPopup.isIRS=!1;a.AddBtnPopup.IRS.testStart=!1;a.AddBtnPopup.HTML="";a.AddBtnPopup.IRS.questions="";var d=b.ClassID;n.show({title:"\u65b0\u589e\u4efb\u52d9",template:'<label class="item item-input item-input"><div class="input-label">\u4efb\u52d9\u540d\u7a31</div><input type="text" ng-model="AddBtnPopup.Name" placeholder="\u8f38\u5165\u4efb\u52d9\u540d\u7a31\uff08\u965015\u5b57\u5167\uff09" maxlength="15"></label><label class="item item-input item-input"><div class="input-label">\u4efb\u52d9\u7c21\u4ecb</div><input type="text" ng-model="AddBtnPopup.Content" placeholder="\u8f38\u5165\u4efb\u52d9\u7c21\u4ecb\uff08\u4e0d\u9650\u5b57\u6578\uff09"></label><label class="item item-input item-input"><div class="input-label">\u5b8c\u6210\u9ede\u6578</div><input type="number" ng-model="AddBtnPopup.Point" placeholder="\u8f38\u5165\u6578\u5b57"></label><label class="item item-input item-select"><div class="input-label">\u4efb\u52d9\u985e\u578b</div><select ng-model="AddBtnPopup.type"><option value="\u96a8\u5802\u6e2c\u9a57">\u96a8\u5802\u6e2c\u9a57</option><option value="\u5c0f\u7d44\u8a0e\u8ad6">\u5c0f\u7d44\u8a0e\u8ad6</option><option value="\u52a0\u5206\u554f\u5377">\u52a0\u5206\u554f\u5377</option><option value="\u8a55\u5206">\u8a55\u5206</option></select></label><label class="item item-input item-select"><div class="input-label">\u622a\u6b62\u65e5\u671f</div><input type="date" ng-model="AddBtnPopup.TimeOut"></label><ion-toggle ng-model="AddBtnPopup.LeaderOnly">\u662f\u5426\u50c5\u9650\u7d44\u9577\u57f7\u884c</ion-toggle><ion-toggle ng-model="AddBtnPopup.isIRS">\u662f\u5426\u9700\u8981\u4f7f\u7528IRS</ion-toggle><label ng-show="!AddBtnPopup.isIRS" class="item item-input item-input"><div class="input-label">HTML</div><textarea cols="50" rows="5" ng-model="AddBtnPopup.HTML" placeholder="\u8f38\u5165HTML\u3002"></textarea></label><div ng-show="AddBtnPopup.isIRS"><label class="item item-input item-input"><div class="input-label">\u8003\u984c\u4e0a\u50b3</div><textarea cols="50" rows="5" ng-model="AddBtnPopup.IRS.questions" placeholder="\u8f38\u5165\u8003\u984c(ex:{})\u3002"></textarea></label><label class="item item-input item-input"><div class="input-label">\u6e2c\u9a57\u6642\u9593</div><input type="number" ng-model="AddBtnPopup.IRS.stageTime" placeholder="\u8f38\u5165\u6578\u5b57(\u55ae\u4f4d\u79d2)"></label><ion-toggle ng-model="AddBtnPopup.IRS.testStart">\u958b\u555f\u6e2c\u9a57</ion-toggle></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u65b0\u589e",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u65b0\u589e");void 0==a.AddBtnPopup.Name||void 0==a.AddBtnPopup.type||void 0==a.AddBtnPopup.TimeOut||void 0==a.AddBtnPopup.LeaderOnly?(console.log("\u8acb\u586b\u5beb\u5b8c\u6574"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u5b8c\u6574\u3002"})):(a.AddBtnPopup.TimeOut=a.AddBtnPopup.TimeOut.setHours(23,
59,59),a.AddBtnPopup.TimeOut=new Date(a.AddBtnPopup.TimeOut),q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(d).collection("\u4efb\u52d9\u5217\u8868").add({Name:a.AddBtnPopup.Name,Content:a.AddBtnPopup.Content,type:a.AddBtnPopup.type,Point:a.AddBtnPopup.Point,TimeOut:a.AddBtnPopup.TimeOut,LeaderOnly:a.AddBtnPopup.LeaderOnly,isIRS:a.AddBtnPopup.isIRS,HTML:a.AddBtnPopup.HTML,finished:[],lock:!1,time:new Date}).then(function(b){console.log("\u65b0\u589e\u4efb\u52d9\u6210\u529f");a.AddBtnPopup.isIRS&&(a.AddBtnPopup.IRS.questions=
[{indexReal:1,question:"\u672c\u5b78\u5e74\u5ea6\u70ba\uff1f",optionA:"106",optionB:"107",optionC:"108",optionD:"109",answer:3},{indexReal:2,question:"\u8cc7\u7ba1\u7cfb\u7cfb\u4e3b\u4efb\u662f\uff1a",optionA:"\u6c6a\u7d20\u537f",optionB:"\u8cf4\u4fca\u7537",optionC:"\u9ec3\u5947\u4fca",optionD:"\u8cf4\u6b63\u7537",answer:4},{indexReal:3,question:"\u672c\u5802\u8ab2\u540d\u7a31\u70ba\uff1a",optionA:"\u7ba1\u7406\u8cc7\u8a0a\u7cfb\u7d71",optionB:"\u7ba1\u7406\u5b78",optionC:"\u5c08\u5bb6\u7ba1\u7406",
optionD:"\u5c08\u6848\u7ba1\u7406",answer:1},{indexReal:4,question:"\u4e0b\u5217\u4f55\u8005\u662f\u9ad8\u79d1\u5927\u6b63\u78ba\u7684\u6821\u5340\u540d\uff1f",optionA:"\u5149\u5fa9",optionB:"\u65b0\u8208",optionC:"\u65d7\u6d25",optionD:"\u516d\u9f9c",answer:3},{indexReal:5,question:"\u672c\u7cfb\u672c\u7cfb\u7cfb\u8fa6\u7684\u4eba\u54e1\u6709\uff1f",optionA:"\u67ef\u5927\u54e5",optionB:"\u9bf0\u9b5a\u54e5",optionC:"\u67f1\u67f1\u59d0",optionD:"\u67efP\u5b78\u59d0",answer:1},{indexReal:6,question:"\u672c\u7cfb\u6bd4\u8f03\u4e0d\u5e25\u7684\u8001\u5e2b\u662f\uff1a",
optionA:"\u5289\u52c7\u5fd7",optionB:"\u9673\u4fe1\u69ae",optionC:"\u738b\u99a8\u8466",optionD:"\u9ec3\u570b\u74bd",answer:3}],q.collection("IRS").doc(d).collection("\u6e2c\u9a57\u5217\u8868").doc(b.id).set({Name:a.AddBtnPopup.Name,questions:a.AddBtnPopup.IRS.questions,stageTime:1E3*a.AddBtnPopup.IRS.stageTime,testStart:a.AddBtnPopup.IRS.testStart}).then(function(a){console.log("\u65b0\u589eIRS\u6210\u529f")})["catch"](function(a){console.error("\u65b0\u589eIRS\u5931\u6557\uff1a",a)}))})["catch"](function(a){console.error("\u65b0\u589e\u4efb\u52d9\u5931\u6557\uff1a",
a)}))}}]})};a.missionShow=function(b){var d=a.missions.findIndex(function(a){return a.$$hashKey===b.$$hashKey});-1!=d?(a.missions[d].show?(a.missions[d].show=!1,a.missions[d].showMsg="\u67e5\u770b\u66f4\u591a"):(a.missions[d].show=!0,a.missions[d].showMsg="\u6536\u5408\u5167\u5bb9"),console.log("\u4fee\u6539\u986f\u793a\u6210\u529f")):console.log("\u4fee\u6539\u986f\u793a\u4e0d\u6210\u529f")};a.response={};a.responseBtn=function(b){q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(f).collection("\u4efb\u52d9\u5217\u8868").doc(b).collection("\u586b\u7b54\u7d50\u679c").add({StuID:"\u6559\u5e2b\u7248",
missionID:b,response:a.response,time:new Date}).then(function(a){console.log("\u56de\u50b3\u586b\u7b54\u7d50\u679c\u6210\u529f")})["catch"](function(a){console.error("\u56de\u50b3\u586b\u7b54\u7d50\u679c\u5931\u6557\uff1a",a)})};var g=[];a.OutputBtn=function(){var a=XLSX.utils.aoa_to_sheet(g);var d="sheet1";var e={SheetNames:[d],Sheets:{}};e.Sheets[d]=a;a=XLSX.write(e,{bookType:"xlsx",bookSST:!1,type:"binary"});d=Blob;e=new ArrayBuffer(a.length);for(var c=new Uint8Array(e),f=0;f!=a.length;++f)c[f]=
a.charCodeAt(f)&255;d=new d([e],{type:"application/octet-stream"});"object"==typeof d&&d instanceof Blob&&(d=URL.createObjectURL(d));a=document.createElement("a");a.href=d;a.download="\u532f\u51fa.xlsx";window.MouseEvent?d=new MouseEvent("click"):(d=document.createEvent("MouseEvents"),d.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));a.dispatchEvent(d)}}else n.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u8ab2\u7a0b\u3002"})},a.SettingMission=function(e,f,g){"status"==
e?(a.missionStatus=[],q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(f).collection("\u4efb\u52d9\u5217\u8868").doc(g).get().then(function(b){a.missionStatus=b.data();a.missionStatus.finished=b.data().finished;a.$apply();a.AllStu=[];q.collection("\u8ab2\u7a0b").doc(f).get().then(function(b){a.AllStu=b.data().ClassStu;a.unfinished=a.AllStu;for(b=0;b<a.missionStatus.finished.length;b++)if(-1!=a.unfinished.indexOf(a.missionStatus.finished[b])&&a.unfinished.splice(a.unfinished.indexOf(a.missionStatus.finished[b]),
1),b>=a.missionStatus.finished.length-1){console.log("\u6700\u5f8c\u4e00\u7b46");for(var d={$jscomp$loop$prop$j$24:0};d.$jscomp$loop$prop$j$24<a.missionStatus.finished.length;d={$jscomp$loop$prop$j$24:d.$jscomp$loop$prop$j$24},d.$jscomp$loop$prop$j$24++)q.collection("\u5e33\u865f").doc(a.missionStatus.finished[d.$jscomp$loop$prop$j$24]).get().then(function(b){return function(c){a.missionStatus.finished[b.$jscomp$loop$prop$j$24]+=c.data().Name;a.$apply()}}(d))["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",
a)});for(d={$jscomp$loop$prop$j$4$26:0};d.$jscomp$loop$prop$j$4$26<a.unfinished.length;d={$jscomp$loop$prop$j$4$26:d.$jscomp$loop$prop$j$4$26},d.$jscomp$loop$prop$j$4$26++)q.collection("\u5e33\u865f").doc(a.unfinished[d.$jscomp$loop$prop$j$4$26]).get().then(function(b){return function(c){a.unfinished[b.$jscomp$loop$prop$j$4$26]+=c.data().Name;a.$apply()}}(d))["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})}})},function(a){console.error("\u53d6\u5f97\u4efb\u52d9\u72c0\u614b\u767c\u751f\u932f\u8aa4\uff1a",
a)}),n.show({title:"\u7b54\u984c\u72c0\u614b(\u5373\u6642\u76e3\u807d)",template:'<div><div class="item item-divider">\u4efb\u52d9\u540d\u7a31</div><div class="item item-content">{{missionStatus.Name}}</div><div class="item item-divider">\u662f\u5426\u9650\u7d44\u9577</div><div class="item item-content">{{missionStatus.LeaderOnly}}</div><div class="item item-divider">\u4eba\u6578</div><div class="item item-content">\u5df2\u5b8c\u6210{{missionStatus.finished.length}}\u4eba\uff0c\u672a\u5b8c\u6210{{unfinished.length}}\u4eba</div><div class="item item-divider">\u5df2\u5b8c\u6210\u540d\u55ae</div><div class="item item-content">{{missionStatus.finished}}</div><div class="item item-divider">\u672a\u5b8c\u6210\u540d\u55ae</div><div class="item item-content">{{unfinished}}</div></div>',
scope:a,buttons:[{text:"\u95dc\u9589",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}}]})):"modify"==e?(a.modifyPopup=[],q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(f).collection("\u4efb\u52d9\u5217\u8868").doc(g).get().then(function(b){a.modifyPopup=b.data();a.$apply()})["catch"](function(a){console.log("\u4fee\u6539\u4efb\u52d9 - \u8f09\u5165\u4efb\u52d9\u8cc7\u8a0a\u767c\u751f\u932f\u8aa4\uff1a",a)}),n.show({title:"\u4fee\u6539\u4efb\u52d9",template:'<label class="item item-input item-input"><div class="input-label">\u4efb\u52d9\u540d\u7a31</div><input type="text" ng-model="modifyPopup.Name" placeholder="\u8f38\u5165\u4efb\u52d9\u540d\u7a31\uff08\u965015\u5b57\u5167\uff09" maxlength="15"></label><label class="item item-input item-input"><div class="input-label">\u4efb\u52d9\u7c21\u4ecb</div><input type="text" ng-model="modifyPopup.Content" placeholder="\u8f38\u5165\u4efb\u52d9\u7c21\u4ecb\uff08\u4e0d\u9650\u5b57\u6578\uff09"></label><label class="item item-input item-input"><div class="input-label">\u5b8c\u6210\u9ede\u6578</div><input type="number" ng-model="modifyPopup.Point" placeholder="\u8f38\u5165\u6578\u5b57"></label><label class="item item-input item-select"><div class="input-label">\u4efb\u52d9\u985e\u578b</div><select ng-model="modifyPopup.type"><option value="\u96a8\u5802\u6e2c\u9a57">\u96a8\u5802\u6e2c\u9a57</option><option value="\u5c0f\u7d44\u8a0e\u8ad6">\u5c0f\u7d44\u8a0e\u8ad6</option><option value="\u52a0\u5206\u554f\u5377">\u52a0\u5206\u554f\u5377</option><option value="\u8a55\u5206">\u8a55\u5206</option></select></label><label class="item item-input item-select"><div class="input-label">\u622a\u6b62\u65e5\u671f</div><input type="date" ng-model="modifyPopup.TimeOut2"></label><ion-toggle ng-model="modifyPopup.LeaderOnly">\u662f\u5426\u50c5\u9650\u7d44\u9577\u57f7\u884c</ion-toggle><ion-toggle ng-model="modifyPopup.lock">\u662f\u5426\u9396\u4f4f\u4efb\u52d9</ion-toggle><label class="item item-input item-input"><div class="input-label">HTML</div><textarea cols="50" rows="5" ng-model="modifyPopup.HTML" placeholder="\u8f38\u5165HTML\u3002"></textarea></label>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u4fee\u6539",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u65b0\u589e");void 0==a.modifyPopup.TimeOut2?n.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u5230\u671f\u65e5\u3002"}):(a.modifyPopup.TimeOut2=a.modifyPopup.TimeOut2.setHours(23,59,59),a.modifyPopup.TimeOut2=new Date(a.modifyPopup.TimeOut2),q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(f).collection("\u4efb\u52d9\u5217\u8868").doc(g).update({Name:a.modifyPopup.Name,
Content:a.modifyPopup.Content,type:a.modifyPopup.type,Point:a.modifyPopup.Point,TimeOut:a.modifyPopup.TimeOut2,LeaderOnly:a.modifyPopup.LeaderOnly,HTML:a.modifyPopup.HTML,lock:a.modifyPopup.lock}).then(function(a){console.log("\u4fee\u6539\u4efb\u52d9\u6210\u529f")})["catch"](function(a){console.error("\u4fee\u6539\u4efb\u52d9\u5931\u6557\uff1a",a)}))}}]})):"delete"==e&&n.confirm({title:"\u522a\u9664\u4efb\u52d9",template:"\u78ba\u5b9a\u8981\u522a\u9664\u4efb\u52d9\u55ce?",buttons:[{text:"\u53d6\u6d88",
type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u522a\u9664",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u522a\u9664");q.collection("\u8ab2\u7a0b\u4efb\u52d9").doc(f).collection("\u4efb\u52d9\u5217\u8868").doc(g)["delete"]().then(function(b){console.log("\u522a\u9664\u4efb\u52d9\u8cc7\u6599\u6210\u529f");a.$apply()})["catch"](function(a){console.error("\u522a\u9664\u4efb\u52d9\u8cc7\u6599\u5931\u6557\uff1a",a)})}}]})}):(console.log("\u5c1a\u672a\u767b\u5165"),
p.go("login"))})}]).controller("root_brainstormingCtrl",["$scope","$stateParams","$state","$ionicPopup","$ionicLoading",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){"eTlMITVmGbSStEQ7B7jw9rIl20N2"===e.uid?(console.log("\u5df2\u767b\u5165\u72c0\u614b"),a.cardShow=!1,q.collection("\u8ab2\u7a0b").get().then(function(e){a.AllClass=[];e.forEach(function(e){a.AllClass.push(e.data());p.go(p.current,{},{reload:!0})});console.log(a.AllClass)}),a.hide=function(){a.cardShow=
!1},a.SelectBtn=function(e){if(void 0!=e){var f=e.ClassID;a.cardShow=!0;a.groups=[];q.collection("\u5206\u7d44").doc(f).collection("group").get().then(function(e){e.forEach(function(b){q.collection("\u5e33\u865f").doc(b.data().leader).get().then(function(d){a.groups.push({id:b.id,leader:b.data().leader+" "+d.data().Name});a.$apply()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u5404\u7d44\u5225\u767c\u751f\u932f\u8aa4\uff1a",
a)});a.DetailBtn=function(e){a.search="fkozq65K\u9801\u7c64\uff1a1";a.tabs=function(b){a.search="fkozq65K\u9801\u7c64\uff1a"+b;var d=a.tabsCounts.findIndex(function(a){return!0===a.active});a.tabsCounts[d].num=d+1;a.tabsCounts[d].active=!1;a.tabsCounts[b-1].num=b;a.tabsCounts[b-1].active=!0;$ionicScrollDelegate.scrollBottom()};q.collection("\u8166\u529b\u6fc0\u76ea").doc(f).collection(e).doc("\u9801\u7c64").get().then(function(b){if(b.exists){a.tabsCounts=[];for(var d=1;d<=b.data().count;d++)1==d?
a.tabsCounts.push({num:d,active:!0}):a.tabsCounts.push({num:d,active:!1});a.$apply()}else q.collection("\u8166\u529b\u6fc0\u76ea").doc(f).collection(e).doc("\u9801\u7c64").set({count:3}).then(function(){console.log("\u521d\u59cb\u5316\u5206\u9801\u6210\u529f")})["catch"](function(a){console.error("\u521d\u59cb\u5316\u5206\u9801\u5931\u6557",a)})})["catch"](function(a){console.log("\u53d6\u5f97 - \u9801\u7c64\u6578\u767c\u751f\u932f\u8aa4\uff1a",a)});a.items=[];q.collection("\u8166\u529b\u6fc0\u76ea").doc(f).collection(e).orderBy("time",
"asc").get().then(function(b){b.forEach(function(b){a.items.push(b.data());a.$apply();console.log("\u65b0\u589e: ",b.data())})})["catch"](function(a){console.log("\u53d6\u5f97 - \u8166\u529b\u6fc0\u76ea\u5167\u5bb9\u767c\u751f\u932f\u8aa4\uff1a",a)});n.show({title:"\u8a0e\u8ad6\u72c0\u6cc1",template:'<div class="tabs-striped tabs-top tabs-background-light tabs-color-calm"><div class="tabs" style="width:93%;top:37px;"><a class="tab-item" ng-class="{true:\'active\',false:\'\'}[tabsCount.active]" ng-repeat="tabsCount in tabsCounts" ng-click="tabs(tabsCount.num)">{{tabsCount.num}}</a></div></div><div class="spacer" style="height: 35px;"></div><div class="list" ng-repeat="item in items | filter:search"><div class="item"><h2>\u7372\u8b9a\u6578\uff1a{{item.like.length}}    \u88ab\u63a1\u7528\uff1a{{item.invited}}</h2><h2 class="brainstorming_h2">{{item.StuName}}\uff1a<span ng-bind-html="item.msg | linky"></span></h2></div></div>',
scope:a,buttons:[{text:"\u95dc\u9589",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u95dc\u9589")}}]})}}else n.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u8ab2\u7a0b\u3002"})}):(console.log("\u5c1a\u672a\u767b\u5165"),p.go("login"))})}]).controller("root_proposalCtrl",["$scope","$stateParams","$state","$ionicPopup","$ionicLoading",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){"eTlMITVmGbSStEQ7B7jw9rIl20N2"===e.uid?(console.log("\u5df2\u767b\u5165\u72c0\u614b"),
a.cardShow=!1,q.collection("\u8ab2\u7a0b").get().then(function(e){a.AllClass=[];e.forEach(function(e){a.AllClass.push(e.data());p.go(p.current,{},{reload:!0})});console.log(a.AllClass)}),a.hide=function(){a.cardShow=!1},a.SelectBtn=function(e){if(void 0!=e){var f=e.ClassID;a.cardShow=!0;a.groups=[];q.collection("\u5206\u7d44").doc(f).collection("group").get().then(function(e){e.forEach(function(b){q.collection("\u5e33\u865f").doc(b.data().leader).get().then(function(d){a.groups.push({id:b.id,leader:b.data().leader+
" "+d.data().Name});a.$apply()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u5404\u7d44\u5225\u767c\u751f\u932f\u8aa4\uff1a",a)});a.DetailBtn=function(e){a.items=[];q.collection("\u63d0\u6848\u805a\u7126").doc(f).collection(e).orderBy("time","asc").get().then(function(b){b.forEach(function(b){var d=b.data(),c=[];d.brainstorming.forEach(function(b){q.collection("\u8166\u529b\u6fc0\u76ea").doc(f).collection(e).doc(b).get().then(function(b){c.push(b.data());
a.$apply()})["catch"](function(a){console.log("\u8166\u529b\u6fc0\u76ea\u5167\u5bb9\u767c\u751f\u932f\u8aa4\uff1a",a)})});a.items.push({ProposalName:d.ProposalName,brainstorming:c,time:d.time});a.$apply();console.log("\u65b0\u589e: ",b.data())})})["catch"](function(a){console.log("\u53d6\u5f97 - \u8166\u529b\u6fc0\u76ea\u5167\u5bb9\u767c\u751f\u932f\u8aa4\uff1a",a)});n.show({title:"\u8a0e\u8ad6\u72c0\u6cc1",template:'<div class="proposal_card" ng-repeat="item in items"><div class="card"><div class="item item-divider">\u63d0\u6848\uff1a\u3010{{item.ProposalName}}\u3011</div><div ng-repeat="brainstorming in item.brainstorming" class="item item-text-wrap proposal_item"><span ng-bind-html="brainstorming.msg | linky"></span></div></div></div>',
scope:a,buttons:[{text:"\u95dc\u9589",type:"button-chanry1",onTap:function(a){console.log("\u9078\u64c7\u95dc\u9589")}}]})}}else n.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u8ab2\u7a0b\u3002"})}):(console.log("\u5c1a\u672a\u767b\u5165"),p.go("login"))})}]).controller("root_pointCtrl",["$scope","$stateParams","$state","$ionicPopup","$ionicLoading",function(a,r,p,n,l){var q=firebase.firestore();firebase.auth().onAuthStateChanged(function(e){"eTlMITVmGbSStEQ7B7jw9rIl20N2"===e.uid?(console.log("\u5df2\u767b\u5165\u72c0\u614b"),
a.cardShow=!1,q.collection("\u8ab2\u7a0b").get().then(function(e){a.AllClass=[];e.forEach(function(e){a.AllClass.push(e.data());p.go(p.current,{},{reload:!0})});console.log(a.AllClass)}),a.hide=function(){a.cardShow=!1},a.SelectBtn=function(e){l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u8ab2\u7a0b\u9ede\u6578\u4e2d...</p>'});if(void 0!=e){var f=e.ClassID;a.cardShow=!0;a.StuPoints=[];q.collection("\u8ab2\u7a0b").doc(f).get().then(function(e){e.data().ClassStu.forEach(function(b){q.collection("\u9ede\u6578").doc(f).collection(b).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").get().then(function(d){var e=
0,c=d.docs.length,g=0,f=[];d.forEach(function(d){-1!=f.indexOf(d.data().check)?(console.log(b+"\u767c\u73fe\u91cd\u8907"),n.alert({title:b+"\u767c\u73fe\u91cd\u8907",template:"\u7de8\u865f\uff1a"+d.id})):f.push(d.data().check);e+=pasw(d.data().point);g++;g==c&&(l.hide(),q.collection("\u5e33\u865f").doc(b).get().then(function(c){a.StuPoints.push({Name:b+" "+c.data().Name,StuID:b,Point:e});a.$apply()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)}))})})["catch"](function(a){console.log("\u8f09\u5165\u7e3d\u9ede\u6578\u767c\u751f\u932f\u8aa4\uff1a",
a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u8ab2\u7a0b\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});a.AddBtn=function(e){a.Stus=[];l.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner><p>\u8f09\u5165\u5b78\u751f\u4e2d...</p>'});q.collection("\u5206\u7d44").doc(f).collection("student").get().then(function(b){b.forEach(function(d){var e=b.docs[b.docs.length-1].id,c=b.docs[b.docs.length-2].id;q.collection("\u5e33\u865f").doc(d.id).get().then(function(b){a.Stus.push({StuID:d.id,
Name:b.data().Name,Checked:!1});d.id!=e&&d.id!=c||l.hide()})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)})})})["catch"](function(a){console.log("\u53d6\u5f97\u672a\u5206\u7d44\u540d\u55ae\u767c\u751f\u932f\u8aa4\uff1a",a)});a.checkStus=[];a.check=function(b){-1===a.checkStus.indexOf(b)?a.checkStus.push(b):a.checkStus.splice(a.checkStus.indexOf(b),1);console.log(a.checkStus)};a.AddBtnPopup=[];n.show({title:"\u767c\u653e\u9ede\u6578",template:'<label class="item item-input item-input"><div class="input-label">\u9ede\u6578\u8aaa\u660e</div><input type="text" ng-model="AddBtnPopup.content" placeholder="\u8f38\u5165\u8aaa\u660e"></label><label class="item item-input item-input"><div class="input-label">\u9ede\u6578\u6578\u91cf</div><input type="number" ng-model="AddBtnPopup.point" placeholder="\u8f38\u5165\u6578\u5b57"></label><label class="item item-input item-select"><div class="input-label">\u767c\u653e\u65e5\u671f</div><input type="date" ng-model="AddBtnPopup.time"></label><div ng-repeat="Stu in Stus"><ion-checkbox ng-model="Stu.Checked" ng-click="check(Stu.StuID)">{{Stu.StuID}} {{Stu.Name}}</ion-checkbox></div>',
scope:a,buttons:[{text:"\u53d6\u6d88",type:"button-default",onTap:function(a){console.log("\u9078\u64c7\u53d6\u6d88")}},{text:"\u767c\u653e",type:"button-chanry1",onTap:function(b){console.log("\u9078\u64c7\u767c\u653e");if(void 0==a.AddBtnPopup.content||void 0==a.AddBtnPopup.point||void 0==a.AddBtnPopup.time)console.log("\u8acb\u586b\u5beb\u5b8c\u6574"),n.alert({title:"\u932f\u8aa4",template:"\u8acb\u586b\u5beb\u5b8c\u6574\u3002"});else if(0==a.checkStus.length)console.log("\u8acb\u81f3\u5c11\u52fe\u4e00\u4f4d"),
n.alert({title:"\u932f\u8aa4",template:"\u8acb\u81f3\u5c11\u52fe\u4e00\u4f4d\u3002"});else{b=new Date;b=b.getFullYear().toString()+b.getMonth()+b.getDate()+b.getHours()+b.getMinutes()+b.getSeconds()+b.getMilliseconds();for(var d=0;d<a.checkStus.length;d++)q.collection("\u9ede\u6578").doc(f).collection(a.checkStus[d]).doc("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").collection("\u9ede\u6578\u6b77\u7a0b\u8a18\u9304").add({content:a.AddBtnPopup.content,point:paswLock(a.AddBtnPopup.point),check:b,time:a.AddBtnPopup.time}).then(function(a){console.log("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u6210\u529f")})["catch"](function(a){console.error("\u52a0\u5206 - \u4e0a\u50b3\u4f3a\u670d\u5668\u5931\u6557\uff1a",
a)})}}}]})};a.update=function(){a.StuPoints=a.StuPoints.sort(function(a,b){return a.Point<b.Point?1:-1});for(var e=[],b=0;5>b;b++)e.push({StuID:a.StuPoints[b].StuID,Point:a.StuPoints[b].Point});q.collection("\u9ede\u6578").doc(f).set({top:e,UpdateTime:new Date}).then(function(a){console.log("\u66f4\u65b0\u6392\u884c\u699c\u6210\u529f");n.alert({title:"\u5b8c\u6210",template:"\u66f4\u65b0\u6392\u884c\u699c\u6210\u529f\u3002<br>\u7b2c\u4e00\u540d "+e[0].StuID+" \u5171 "+e[0].Point+"\u9ede<br>\u7b2c\u4e8c\u540d "+
e[1].StuID+" \u5171 "+e[1].Point+"\u9ede<br>\u7b2c\u4e09\u540d "+e[2].StuID+" \u5171 "+e[2].Point+"\u9ede<br>\u7b2c\u56db\u540d "+e[3].StuID+" \u5171 "+e[3].Point+"\u9ede<br>\u7b2c\u4e94\u540d "+e[4].StuID+" \u5171 "+e[4].Point+"\u9ede"})})["catch"](function(a){console.error("\u66f4\u65b0\u6392\u884c\u699c\u5931\u6557\uff1a",a);n.alert({title:"\u932f\u8aa4",template:"\u66f4\u65b0\u6392\u884c\u699c\u5931\u6557\u3002"})})}}else n.alert({title:"\u932f\u8aa4",template:"\u8acb\u9078\u64c7\u8ab2\u7a0b\u3002"})}):
(console.log("\u5c1a\u672a\u767b\u5165"),p.go("login"))})}]).controller("rootmenuCtrl",["$scope","$stateParams","$state",function(a,r,p){var n=firebase.firestore();firebase.auth().onAuthStateChanged(function(a){if(a){console.log("\u5df2\u767b\u5165\u72c0\u614b");var l=a.email.substring(0,a.email.indexOf("@")).toUpperCase();localStorage.getItem("ClassID");n.collection("\u5e33\u865f").doc(l).get().then(function(a){document.getElementById("menu-heading1").innerText=l+" "+a.data().Name;localStorage.setItem("StuName",
a.data().Name)})["catch"](function(a){console.log("\u67e5\u8a62\u59d3\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});document.getElementById("menu-list-item8").addEventListener("click",function(){firebase.auth().signOut().then(function(){console.log("\u767b\u51fa\u6210\u529f");localStorage.clear()})["catch"](function(a){console.log("\u767b\u51fa\u767c\u751f\u932f\u8aa4!")})},!1);n.collection("\u5e33\u865f").doc(l).get().then(function(a){console.log("\u66f4\u65b0\u5927\u982d\u7167\u6210\u529f");firebase.storage().ref().child("members/"+
a.data().Img).getDownloadURL().then(function(a){document.getElementById("menu-img").src=a})})["catch"](function(a){console.log("\u67e5\u8a62\u5716\u7247\u6a94\u540d\u767c\u751f\u932f\u8aa4\uff1a",a)});document.getElementById("menu-heading2").innerText="Copyright \u00a9 2019 ver "+verson}else console.log("\u5c1a\u672a\u767b\u5165"),p.go("login")})}]);